function module(t,e){"use strict";var r=t("../core/renderer"),n=t("../core/element_data"),a=t("../core/utils/array").wrapToArray,i=t("../core/utils/array").inArray,s=t("../core/utils/iterator"),o=t("../core/utils/dom").contains,f=t("./core/event_registrator"),u=t("./utils"),c=t("./gesture/emitter.gesture"),d=t("./core/emitter_registrator"),g="dxdragstart",h="dxdrag",v="dxdragend",_="dxdragenter",l="dxdragleave",p="dxdrop",m="dxDragEventsCount",x=[],D=[],E=[],O={setup:function(t,e){var r;-1!==i(t,x)||(x.push(t),D.push([]),E.push(e||{}))},add:function(t,e){var r=i(t,x);this.updateEventsCounter(t,e.type,1);var n=e.selector;-1===i(n,D[r])&&D[r].push(n)},updateEventsCounter:function(t,e,r){if([_,l,p].indexOf(e)>-1){var a=n.data(t,"dxDragEventsCount")||0;n.data(t,"dxDragEventsCount",Math.max(0,a+r))}},remove:function(t,e){this.updateEventsCounter(t,e.type,-1)},teardown:function(t){var e;if(!n.data(t,"dxDragEventsCount")){var r=i(t,x);x.splice(r,1),D.splice(r,1),E.splice(r,1),n.removeData(t,"dxDragEventsCount")}}};f(_,O),f(l,O),f(p,O);var T=function(t){var e=i(t.get(0),x),r=D[e],n=t.find(r.join(", "));return-1!==i(void 0,r)&&(n=n.add(t)),n},y=function(t){var e=i(t.get(0),x);return E[e]},C=function(t,e){return t.itemPositionFunc?t.itemPositionFunc(e):e.offset()},B=function(t,e){return t.itemSizeFunc?t.itemSizeFunc(e):{width:e.get(0).getBoundingClientRect().width,height:e.get(0).getBoundingClientRect().height}},w;d({emitter:c.inherit({ctor:function(t){this.callBase(t),this.direction="both"},_init:function(t){this._initEvent=t},_start:function(t){t=this._fireEvent("dxdragstart",this._initEvent),this._maxLeftOffset=t.maxLeftOffset,this._maxRightOffset=t.maxRightOffset,this._maxTopOffset=t.maxTopOffset,this._maxBottomOffset=t.maxBottomOffset;var e=a(t.targetElements||(null===t.targetElements?[]:x));this._dropTargets=s.map(e,(function(t){return r(t).get(0)}))},_move:function(t){var e=u.eventData(t),r=this._calculateOffset(e);t=this._fireEvent("dxdrag",t,{offset:r}),this._processDropTargets(t),t._cancelPreventDefault||t.preventDefault()},_calculateOffset:function(t){return{x:this._calculateXOffset(t),y:this._calculateYOffset(t)}},_calculateXOffset:function(t){if("vertical"!==this.direction){var e=t.x-this._startEventData.x;return this._fitOffset(e,this._maxLeftOffset,this._maxRightOffset)}return 0},_calculateYOffset:function(t){if("horizontal"!==this.direction){var e=t.y-this._startEventData.y;return this._fitOffset(e,this._maxTopOffset,this._maxBottomOffset)}return 0},_fitOffset:function(t,e,r){return null!=e&&(t=Math.max(t,-e)),null!=r&&(t=Math.min(t,r)),t},_processDropTargets:function(t){var e=this._findDropTarget(t),r;e===this._currentDropTarget||(this._fireDropTargetEvent(t,l),this._currentDropTarget=e,this._fireDropTargetEvent(t,_))},_fireDropTargetEvent:function(t,e){if(this._currentDropTarget){var r={type:e,originalEvent:t,draggingElement:this._$element.get(0),target:this._currentDropTarget};u.fireEvent(r)}},_findDropTarget:function(t){var e,n=this;return s.each(x,(function(a,i){if(n._checkDropTargetActive(i)){var o=r(i);s.each(T(o),(function(a,i){var s=r(i);n._checkDropTarget(y(o),s,t)&&(e=i)}))}})),e},_checkDropTargetActive:function(t){var e=!1;return s.each(this._dropTargets,(function(r,n){return!(e=e||n===t||o(n,t))})),e},_checkDropTarget:function(t,e,r){var n;if(e.get(0)===this._$element.get(0))return!1;var a=C(t,e);if(r.pageX<a.left)return!1;if(r.pageY<a.top)return!1;var i=B(t,e);return!(r.pageX>a.left+i.width)&&(!(r.pageY>a.top+i.height)&&e)},_end:function(t){var e=u.eventData(t);this._fireEvent("dxdragend",t,{offset:this._calculateOffset(e)}),this._fireDropTargetEvent(t,p),delete this._currentDropTarget}}),events:["dxdragstart","dxdrag","dxdragend"]}),e.move="dxdrag",e.start="dxdragstart",e.end="dxdragend",e.enter=_,e.leave=l,e.drop=p}

