function module(e,r,t){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("../core/utils/type"),n,s=d(e("../core/config")),f,u=d(e("../core/guid")),a=e("../core/utils/extend"),y=e("./errors"),c,l=d(e("../core/utils/object")),p=e("./utils");function d(e){return e&&e.__esModule?e:{default:e}}function v(e,r){for(var t,i="string"==typeof r?r.split():r.slice();i.length;)if((t=i.shift())in e)return!0;return!1}function m(e,r,t,i){var o,n;if(i){for(var s=0;s<r.length;s++)if(n=m(e,(o=r[s].items||r[s].collapsedItems||[])||[],t,i-1))return n}else if(P(e,r,t)>=0)return r}function h(e,r,t,i){return i?m(e,r,t,i)||[]:r}function k(e,r){if(e.key()&&!r._hasKeyMap){for(var t={},i=0,o=r.length;i<o;i++)t[JSON.stringify(e.keyOf(r[i]))]=!0;r._hasKeyMap=t}}function b(e,r){return!e._hasKeyMap||e._hasKeyMap[JSON.stringify(r)]}function g(e,r){e._hasKeyMap&&(e._hasKeyMap[JSON.stringify(r)]=!0)}function E(e,r,t,i,n){t.forEach((function(t){var s="insert"===t.type?r:h(e,r,t.key,i);switch(k(e,s),t.type){case"update":S(e,s,t.key,t.data,!0);break;case"insert":x(e,s,t.data,n&&(0,o.isDefined)(t.index)?t.index:-1,!0);break;case"remove":O(e,s,t.key,!0)}}))}function S(e,r,t,i,o){var n,f=!0,u=e.key();if(u){if(v(i,u)&&!(0,p.keysEqual)(u,t,e.keyOf(i)))return!o&&(0,p.rejectedPromise)(y.errors.Error("E4017"));var a=P(e,r,t);if(a<0)return!o&&(0,p.rejectedPromise)(y.errors.Error("E4009"));n=r[a]}else n=t;if(l.default.deepExtendArraySafe(n,i,!0),!o)return(0,s.default)().useLegacyStoreResult?(0,p.trivialPromise)(t,i):(0,p.trivialPromise)(n,t)}function x(e,r,t,n,f){var c,l,d=e.key();if(l=(0,o.isPlainObject)(t)?(0,a.extend)({},t):t,d){if(void 0===(c=e.keyOf(l))||"object"===(void 0===c?"undefined":i(c))&&(0,o.isEmptyObject)(c)){if(Array.isArray(d))throw y.errors.Error("E4007");c=l[d]=String(new u.default)}else if(void 0!==r[P(e,r,c)])return!f&&(0,p.rejectedPromise)(y.errors.Error("E4008"))}else c=l;if(n>=0?r.splice(n,0,l):r.push(l),g(r,c),!f)return(0,p.trivialPromise)((0,s.default)().useLegacyStoreResult?t:l,c)}function O(e,r,t,i){var o=P(e,r,t);if(o>-1&&r.splice(o,1),!i)return(0,p.trivialPromise)(t)}function P(e,r,t){var i=e.key();if(!b(r,t))return-1;for(var o=0,n=r.length;o<n;o++)if((0,p.keysEqual)(i,e.keyOf(r[o]),t))return o;return-1}t.exports.applyBatch=E,t.exports.update=S,t.exports.insert=x,t.exports.remove=O,t.exports.indexByKey=P}

