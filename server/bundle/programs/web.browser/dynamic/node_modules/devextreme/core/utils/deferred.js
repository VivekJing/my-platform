function module(e,t){"use strict";var i=e("../utils/type"),n=i.isPromise,r=i.isDeferred,s=e("../utils/extend").extend,o=e("../utils/callbacks"),h=[{method:"resolve",handler:"done",state:"resolved"},{method:"reject",handler:"fail",state:"rejected"},{method:"notify",handler:"progress"}],l=function(){var e=this;this._state="pending",this._promise={},h.forEach(function(t){var i=t.method;this[i+"Callbacks"]=new o,this[i]=function(){return this[i+"With"](this._promise,arguments)}.bind(this),this._promise[t.handler]=function(t){if(!t)return this;var n=e[i+"Callbacks"];return n.fired()?t.apply(e[i+"Context"],e[i+"Args"]):n.add(function(e,i){t.apply(e,i)}.bind(this)),this}}.bind(this)),this._promise.always=function(e){return this.done(e).fail(e)},this._promise.catch=function(e){return this.then(null,e)},this._promise.then=function(e,t){var i=new l;return["done","fail"].forEach(function(s){var o="done"===s?e:t;this[s]((function(){if(o){var e=o&&o.apply(this,arguments);r(e)?e.done(i.resolve).fail(i.reject):n(e)?e.then(i.resolve,i.reject):i.resolve.apply(this,e?[e]:arguments)}else i["done"===s?"resolve":"reject"].apply(this,arguments)}))}.bind(this)),i.promise()},this._promise.state=function(){return e._state},this._promise.promise=function(t){return t?s(t,e._promise):e._promise},this._promise.promise(this)};h.forEach((function(e){var t=e.method,i=e.state;l.prototype[t+"With"]=function(e,n){var r=this[t+"Callbacks"];return"pending"===this.state()&&(this[t+"Args"]=n,this[t+"Context"]=e,i&&(this._state=i),r.fire(e,n)),this}})),t.fromPromise=function(e,t){if(r(e))return e;if(n(e)){var i=new l;return e.then((function(){i.resolveWith.apply(i,[t].concat([[].slice.call(arguments)]))}),(function(){i.rejectWith.apply(i,[t].concat([[].slice.call(arguments)]))})),i}return(new l).resolveWith(t,[e])};var a=function(){if(1===arguments.length)return t.fromPromise(arguments[0]);for(var e=[].slice.call(arguments),i=[],n=0,s=new l,o=function(t){return function(r){i[t]=this,e[t]=arguments.length>1?[].slice.call(arguments):r,++n===e.length&&s.resolveWith(i,e)}},h=0;h<e.length;h++)r(e[h])?e[h].promise().done(o(h)).fail(s.reject):n++;return n===e.length&&s.resolveWith(i,e),s.promise()};t.setStrategy=function(e){l=e.Deferred,a=e.when},t.Deferred=function(){return new l},t.when=function(){return a.apply(this,arguments)}}

