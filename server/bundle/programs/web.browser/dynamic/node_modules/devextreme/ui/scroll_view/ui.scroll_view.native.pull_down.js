function module(t,e,i){"use strict";var s=t("../../core/renderer"),l=t("../../core/utils/callbacks"),o=t("../../animation/translator"),n=t("./ui.scrollable.native"),a=t("../load_indicator"),h=t("../../core/utils/iterator").each,c=t("../../core/utils/browser"),r=t("../../core/utils/deferred").Deferred,u="dx-scrollview-pull-down-loading",_="dx-scrollview-pull-down-ready",d="dx-scrollview-pull-down-image",p="dx-scrollview-pull-down-indicator",w="dx-scrollview-pull-down-text",f="dx-scrollview-pull-down-text-visible",m=0,v=1,D=2,x=3,T=400,b=n.inherit({_init:function(t){this.callBase(t),this._$topPocket=t._$topPocket,this._$pullDown=t._$pullDown,this._$bottomPocket=t._$bottomPocket,this._$refreshingText=t._$refreshingText,this._$scrollViewContent=s(t.content()),this._initCallbacks()},_initCallbacks:function(){this.pullDownCallbacks=l(),this.releaseCallbacks=l(),this.reachBottomCallbacks=l()},render:function(){this.callBase(),this._renderPullDown(),this._releaseState()},_renderPullDown:function(){var t=s("<div>").addClass("dx-scrollview-pull-down-image"),e=s("<div>").addClass("dx-scrollview-pull-down-indicator"),i=new a(s("<div>")).$element(),l=this._$pullDownText=s("<div>").addClass("dx-scrollview-pull-down-text");this._$pullingDownText=s("<div>").text(this.option("pullingDownText")).appendTo(l),this._$pulledDownText=s("<div>").text(this.option("pulledDownText")).appendTo(l),this._$refreshingText=s("<div>").text(this.option("refreshingText")).appendTo(l),this._$pullDown.empty().append(t).append(e.append(i)).append(l)},_releaseState:function(){this._state=0,this._refreshPullDownText()},_pushBackFromBoundary:function(){this._isLocked()||this._component.isEmpty()||this.callBase()},_refreshPullDownText:function(){var t=this,e=[{element:this._$pullingDownText,visibleState:0},{element:this._$pulledDownText,visibleState:1},{element:this._$refreshingText,visibleState:2}];h(e,(function(e,i){var s=t._state===i.visibleState?"addClass":"removeClass";i.element[s]("dx-scrollview-pull-down-text-visible")}))},update:function(){this.callBase(),this._setTopPocketOffset()},_updateDimensions:function(){this.callBase(),this._topPocketSize=this._$topPocket.height(),this._bottomPocketSize=this._$bottomPocket.height(),c.msie?this._scrollOffset=Math.round(100*(this._$container.height()-this._$content.height()))/100:this._scrollOffset=this._$container.height()-this._$content.height()},_allowedDirections:function(){var t=this.callBase();return t.vertical=t.vertical||this._pullDownEnabled,t},_setTopPocketOffset:function(){this._$topPocket.css({top:-this._topPocketSize})},handleEnd:function(){this.callBase(),this._complete()},handleStop:function(){this.callBase(),this._complete()},_complete:function(){1===this._state&&(this._setPullDownOffset(this._topPocketSize),clearTimeout(this._pullDownRefreshTimeout),this._pullDownRefreshTimeout=setTimeout(function(){this._pullDownRefreshing()}.bind(this),400))},_setPullDownOffset:function(t){o.move(this._$topPocket,{top:t}),o.move(this._$scrollViewContent,{top:t})},handleScroll:function(t){if(this.callBase(t),2!==this._state){var e=this.location().top,i=(this._location||0)-e;this._location=e,this._isPullDown()?this._pullDownReady():i>0&&this._isReachBottom()?this._reachBottom():this._stateReleased()}},_isPullDown:function(){return this._pullDownEnabled&&this._location>=this._topPocketSize},_isReachBottom:function(){return c.msie?this._reachBottomEnabled&&this._location-(this._scrollOffset+this._bottomPocketSize)<=.1:this._reachBottomEnabled&&this._location<=this._scrollOffset+this._bottomPocketSize},_reachBottom:function(){3!==this._state&&(this._state=3,this.reachBottomCallbacks.fire())},_pullDownReady:function(){1!==this._state&&(this._state=1,this._$pullDown.addClass("dx-scrollview-pull-down-ready"),this._refreshPullDownText())},_stateReleased:function(){0!==this._state&&(this._$pullDown.removeClass("dx-scrollview-pull-down-loading").removeClass("dx-scrollview-pull-down-ready"),this._releaseState())},_pullDownRefreshing:function(){2!==this._state&&(this._state=2,this._$pullDown.addClass("dx-scrollview-pull-down-loading").removeClass("dx-scrollview-pull-down-ready"),this._refreshPullDownText(),this.pullDownCallbacks.fire())},pullDownEnable:function(t){t&&(this._updateDimensions(),this._setTopPocketOffset()),this._pullDownEnabled=t},reachBottomEnable:function(t){this._reachBottomEnabled=t},pendingRelease:function(){this._state=1},release:function(){var t=new r;return this._updateDimensions(),clearTimeout(this._releaseTimeout),3===this._state&&(this._state=0),this._releaseTimeout=setTimeout(function(){this._setPullDownOffset(0),this._stateReleased(),this.releaseCallbacks.fire(),this._updateAction(),t.resolve()}.bind(this),400),t.promise()},dispose:function(){clearTimeout(this._pullDownRefreshTimeout),clearTimeout(this._releaseTimeout),this.callBase()}});i.exports=b}

