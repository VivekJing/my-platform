function module(t,e,n){"use strict";var o=t("../../core/renderer"),i=t("../shared/async_template_mixin"),p=t("../../events/core/events_engine"),s=t("../../core/guid"),a=t("../../core/component_registrator"),r=t("../../core/utils/common"),d=t("../../core/utils/dom"),l=t("../widget/selectors").focused,u=t("../../core/utils/iterator").each,c=t("../../core/utils/type").isDefined,h=t("../../core/utils/extend").extend,_=t("../../core/utils/dom").getPublicElement,f=t("../widget/ui.errors"),g=t("../../animation/position"),m=t("../../core/utils/position").getDefaultAlignment,v=t("../../localization/message"),w=t("../button"),b=t("../../events/utils"),B=t("../text_box"),O=t("../../events/click"),C=t("../widget/function_template"),D=t("../popup"),y="dx-dropdowneditor",P="dx-dropdowneditor-input-wrapper",x="dx-dropdowneditor-button",T="dx-dropdowneditor-icon",H="dx-dropdowneditor-overlay",$="dx-dropdowneditor-overlay-flipped",I="dx-dropdowneditor-active",E="dx-dropdowneditor-button-visible",k="dx-dropdowneditor-field-clickable",A=B.inherit({_supportedKeys:function(){var t=function(t){return!!this.option("opened")&&(t.preventDefault(),!0)};return h({},this.callBase(),{tab:function(t){if(this.option("opened"))if("instantly"!==this.option("applyValueMode")){var e=t.shiftKey?this._getLastPopupElement():this._getFirstPopupElement();e&&p.trigger(e,"focus"),t.preventDefault()}else this.close()},escape:function(t){this.option("opened")&&t.preventDefault(),this.close()},upArrow:function(t){return t.preventDefault(),t.stopPropagation(),!t.altKey||(this.close(),!1)},downArrow:function(t){return t.preventDefault(),t.stopPropagation(),!t.altKey||(this._validatedOpening(),!1)},enter:function(t){return this.option("opened")&&(t.preventDefault(),this._valueChangeEventHandler(t)),!0},home:t,end:t})},_getDefaultOptions:function(){return h(this.callBase(),{value:null,onOpened:null,onClosed:null,opened:!1,acceptCustomValue:!0,applyValueMode:"instantly",deferRendering:!0,activeStateEnabled:!0,dropDownButtonTemplate:"dropDownButton",fieldTemplate:null,contentTemplate:null,openOnFieldClick:!1,showDropDownButton:!0,dropDownOptions:{},popupPosition:this._getDefaultPopupPosition(),onPopupInitialized:null,applyButtonText:v.format("OK"),cancelButtonText:v.format("Cancel"),buttonsLocation:"default",showPopupTitle:!1})},_getDefaultPopupPosition:function(){var t=m(this.option("rtlEnabled"));return{offset:{h:0,v:-1},my:t+" top",at:t+" bottom",collision:"flip flip"}},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(t){var e="generic"===t.platform,n="win"===t.platform&&t.version&&10===t.version[0];return e||n},options:{popupPosition:{offset:{v:0}}}}])},_inputWrapper:function(){return this.$element().find(".dx-dropdowneditor-input-wrapper")},_init:function(){this.callBase(),this._initVisibilityActions(),this._initPopupInitializedAction(),this._initInnerOptionCache("dropDownOptions")},_initVisibilityActions:function(){this._openAction=this._createActionByOption("onOpened",{excludeValidators:["disabled","readOnly"]}),this._closeAction=this._createActionByOption("onClosed",{excludeValidators:["disabled","readOnly"]})},_initPopupInitializedAction:function(){this._popupInitializedAction=this._createActionByOption("onPopupInitialized",{excludeValidators:["disabled","readOnly","designMode"]})},_initMarkup:function(){this.callBase(),this.$element().addClass("dx-dropdowneditor"),this.setAria("role","combobox")},_render:function(){this.callBase(),this._renderOpenHandler(),this._renderOpenedState()},_renderContentImpl:function(){this.option("deferRendering")||this._createPopup()},_renderInput:function(){this.callBase(),this.$element().wrapInner(o("<div>").addClass("dx-dropdowneditor-input-wrapper")),this._$container=this.$element().children().eq(0),this.setAria({haspopup:"true",autocomplete:"list"})},_readOnlyPropValue:function(){return!this.option("acceptCustomValue")||this.callBase()},_cleanFocusState:function(){this.callBase(),this.option("fieldTemplate")&&p.off(this._input(),"focusin focusout beforeactivate")},_getFieldTemplate:function(){return this.option("fieldTemplate")&&this._getTemplateByOption("fieldTemplate")},_renderField:function(){var t=this._getFieldTemplate();t&&this._renderTemplatedField(t,this._fieldRenderData())},_renderPlaceholder:function(){var t;!!this._getFieldTemplate()||this.callBase()},_renderTemplatedField:function(t,e){var n=this,o=l(this._input()),i=this._$container;this._disposeKeyboardProcessor();var s=this._$beforeButtonsContainer&&this._$beforeButtonsContainer[0].parentNode,a=this._$afterButtonsContainer&&this._$afterButtonsContainer[0].parentNode;s&&s.removeChild(this._$beforeButtonsContainer[0]),a&&a.removeChild(this._$afterButtonsContainer[0]),this._detachFocusEvents(),i.empty(),this._$dropDownButton=null,this._$clearButton=null,t.render({model:e,container:d.getPublicElement(i),onRendered:function(){var t=n._input();if(!t.length)throw f.Error("E1010");n._refreshEvents(),n._refreshValueChangeEvent(),n._renderFocusState(),o&&p.trigger(t,"focus")}})},_fieldRenderData:function(){return this.option("value")},_renderInputAddons:function(){this._renderField(),this.callBase(),this._renderDropDownButton()},_renderDropDownButton:function(){this._$dropDownButton&&(this._$dropDownButton.remove(),this._$dropDownButton=null);var t=this.option("showDropDownButton");this.$element().toggleClass(E,t),t&&(this._$dropDownButton=this._createDropDownButton(),this._attachDropDownButtonClickHandler())},_attachDropDownButtonClickHandler:function(){this.option("showDropDownButton")&&!this.option("openOnFieldClick")&&this._$dropDownButton.dxButton("option","onClick",this._openHandler.bind(this))},_initTemplates:function(){this.callBase(),this._defaultTemplates.dropDownButton=new C((function(t){var e=o("<div>").addClass("dx-dropdowneditor-icon");o(t.container).append(e)}),this)},_createDropDownButton:function(){var t=this,e=o("<div>").addClass("dx-dropdowneditor-button").prependTo(this._buttonsContainer());return this._createComponent(e,w,{focusStateEnabled:!1,hoverStateEnabled:!1,activeStateEnabled:!1,disabled:this.option("readOnly"),useInkRipple:!1,template:this._getTemplateByOption("dropDownButtonTemplate")}),e.removeClass("dx-button"),p.on(e,"mousedown",(function(e){t.$element().is(".dx-state-focused")&&e.preventDefault()})),e},_renderOpenHandler:function(){var t=this,e=this._inputWrapper(),n=b.addNamespace(O.name,this.NAME),o=this.option("openOnFieldClick");p.off(e,n),p.on(e,n,this._getInputClickHandler(o)),this.$element().toggleClass(k,o),o&&(this._openOnFieldClickAction=this._createAction(this._openHandler.bind(this)))},_getInputClickHandler:function(t){var e=this;return t?function(t){e._executeOpenAction(t)}:function(t){e._focusInput()}},_openHandler:function(){this._toggleOpenState()},_executeOpenAction:function(t){this._openOnFieldClickAction({event:t})},_keyboardEventBindingTarget:function(){return this._input()},_focusInput:function(){return!this.option("disabled")&&(this.option("focusStateEnabled")&&!l(this._input())&&p.trigger(this._input(),"focus"),!0)},_toggleOpenState:function(t){this._focusInput()&&(this.option("readOnly")||(t=arguments.length?t:!this.option("opened"),this.option("opened",t)))},_renderOpenedState:function(){var t=this.option("opened");t&&this._createPopup(),this.$element().toggleClass(I,t),this._setPopupOption("visible",t),this.setAria({expanded:t,owns:t?this._popupContentId:void 0})},_createPopup:function(){this._$popup||(this._$popup=o("<div>").addClass(H).addClass(this.option("customOverlayCssClass")).appendTo(this.$element()),this._renderPopup(),this._renderPopupContent())},_renderPopup:function(){this._popup=this._createComponent(this._$popup,D,h(this._popupConfig(),this._getInnerOptionsCache("dropDownOptions"))),this._popup.on({showing:this._popupShowingHandler.bind(this),shown:this._popupShownHandler.bind(this),hiding:this._popupHidingHandler.bind(this),hidden:this._popupHiddenHandler.bind(this)}),this._popup.option("onContentReady",this._contentReadyHandler.bind(this)),this._contentReadyHandler(),this._popupContentId="dx-"+new s,this.setAria("id",this._popupContentId,this._popup.$content()),this._bindInnerWidgetOptions(this._popup,"dropDownOptions")},_contentReadyHandler:r.noop,_popupConfig:function(){return{onInitialized:this._popupInitializedHandler(),position:h(this.option("popupPosition"),{of:this.$element()}),showTitle:this.option("showPopupTitle"),width:"auto",height:"auto",shading:!1,closeOnTargetScroll:!0,closeOnOutsideClick:this._closeOutsideDropDownHandler.bind(this),animation:{show:{type:"fade",duration:0,from:0,to:1},hide:{type:"fade",duration:400,from:1,to:0}},deferRendering:!1,focusStateEnabled:!1,showCloseButton:!1,toolbarItems:this._getPopupToolbarItems(),onPositioned:this._popupPositionedHandler.bind(this),fullScreen:!1}},_popupInitializedHandler:function(){if(this.option("onPopupInitialized"))return function(t){this._popupInitializedAction({popup:t.component})}.bind(this)},_popupPositionedHandler:function(t){t.position&&this._popup.overlayContent().toggleClass($,t.position.v.flip)},_popupShowingHandler:r.noop,_popupHidingHandler:function(){this.option("opened",!1)},_popupShownHandler:function(){this._openAction(),this._$validationMessage&&this._$validationMessage.dxOverlay("option","position",this._getValidationMessagePosition())},_popupHiddenHandler:function(){this._closeAction(),this._$validationMessage&&this._$validationMessage.dxOverlay("option","position",this._getValidationMessagePosition())},_getValidationMessagePosition:function(){var t="below";if(this._popup&&this._popup.option("visible")){var e=g.setup(this.$element()).top,n=g.setup(this._popup.$content()).top;t=e+this.option("popupPosition").offset.v>n?"below":"above"}return this.callBase(t)},_renderPopupContent:function(){var t=this._getTemplateByOption("contentTemplate");if(t&&this.option("contentTemplate")){var e=this._popup.$content(),n={value:this._fieldRenderData(),component:this};e.empty(),t.render({container:d.getPublicElement(e),model:n})}},_closeOutsideDropDownHandler:function(t){var e=o(t.target),n=!!e.closest(this.$element()).length,i=!!e.closest(this._$dropDownButton).length,p;return!n&&!i},_clean:function(){delete this._$dropDownButton,delete this._openOnFieldClickAction,this._$popup&&(this._$popup.remove(),delete this._$popup,delete this._popup),this.callBase()},_setPopupOption:function(t,e){this._setWidgetOption("_popup",arguments)},_validatedOpening:function(){this.option("readOnly")||this._toggleOpenState(!0)},_getPopupToolbarItems:function(){return"useButtons"===this.option("applyValueMode")?this._popupToolbarItemsConfig():[]},_getFirstPopupElement:function(){return this._popup._wrapper().find(".dx-popup-done.dx-button")},_getLastPopupElement:function(){return this._popup._wrapper().find(".dx-popup-cancel.dx-button")},_popupElementTabHandler:function(t){var e=o(t.currentTarget);(t.shiftKey&&e.is(this._getFirstPopupElement())||!t.shiftKey&&e.is(this._getLastPopupElement()))&&(p.trigger(this._input(),"focus"),t.preventDefault())},_popupElementEscHandler:function(){p.trigger(this._input(),"focus"),this.close()},_popupButtonInitializedHandler:function(t){t.component.registerKeyHandler("tab",this._popupElementTabHandler.bind(this)),t.component.registerKeyHandler("escape",this._popupElementEscHandler.bind(this))},_popupToolbarItemsConfig:function(){var t=[{shortcut:"done",options:{onClick:this._applyButtonHandler.bind(this),text:this.option("applyButtonText"),onInitialized:this._popupButtonInitializedHandler.bind(this)}},{shortcut:"cancel",options:{onClick:this._cancelButtonHandler.bind(this),text:this.option("cancelButtonText"),onInitialized:this._popupButtonInitializedHandler.bind(this)}}];return this._applyButtonsLocation(t)},_applyButtonsLocation:function(t){var e=this.option("buttonsLocation"),n=t;if("default"!==e){var o=r.splitPair(e);u(n,(function(t,e){h(e,{toolbar:o[0],location:o[1]})}))}return n},_applyButtonHandler:function(){this.close(),this.option("focusStateEnabled")&&this.focus()},_cancelButtonHandler:function(){this.close(),this.option("focusStateEnabled")&&this.focus()},_toggleReadOnlyState:function(){this.callBase(),this._$dropDownButton&&this._$dropDownButton.dxButton("option","disabled",this.option("readOnly"))},_updatePopupWidth:r.noop,_popupOptionChanged:function(t){var e=this._getOptionsFromContainer(t);this._setPopupOption(e),-1!==Object.keys(e).indexOf("width")&&void 0===e.width&&this._updatePopupWidth()},_optionChanged:function(t){switch(t.name){case"opened":this._renderOpenedState();break;case"onOpened":case"onClosed":this._initVisibilityActions();break;case"onPopupInitialized":this._initPopupInitializedAction();break;case"fieldTemplate":c(t.value)?this._renderInputAddons():this._invalidate();break;case"showDropDownButton":case"contentTemplate":case"acceptCustomValue":case"openOnFieldClick":this._invalidate();break;case"dropDownButtonTemplate":this._renderDropDownButton();break;case"dropDownOptions":this._popupOptionChanged(t),this._cacheInnerOptions("dropDownOptions",t.value);break;case"popupPosition":case"deferRendering":break;case"applyValueMode":case"applyButtonText":case"cancelButtonText":case"buttonsLocation":this._setPopupOption("toolbarItems",this._getPopupToolbarItems());break;case"showPopupTitle":this._setPopupOption("showTitle",t.value);break;default:this.callBase(t)}},open:function(){this.option("opened",!0)},close:function(){this.option("opened",!1)},field:function(){return _(this._input())},content:function(){return this._popup?this._popup.content():null}}).include(i);a("dxDropDownEditor",A),n.exports=A,n.exports.default=n.exports}

