function module(e,t,s){"use strict";var i=e("../../data/query"),o=e("../../core/utils/common"),n=e("../../core/utils/type"),r=o.getKeyHash,a=e("../../core/class"),l=e("../../core/utils/deferred").Deferred;s.exports=a.inherit({ctor:function(e){this.options=e,this._clearItemKeys()},_clearItemKeys:function(){this._setOption("addedItemKeys",[]),this._setOption("removedItemKeys",[]),this._setOption("removedItems",[]),this._setOption("addedItems",[])},validate:o.noop,_setOption:function(e,t){this.options[e]=t},onSelectionChanged:function e(){var t=this.options.addedItemKeys,s=this.options.removedItemKeys,i=this.options.addedItems,n=this.options.removedItems,r=this.options.selectedItems,a=this.options.selectedItemKeys,e=this.options.onSelectionChanged||o.noop;this._clearItemKeys(),e({selectedItems:r,selectedItemKeys:a,addedItemKeys:t,removedItemKeys:s,addedItems:i,removedItems:n})},equalKeys:function(e,t){return this.options.equalByReference&&n.isObject(e)&&n.isObject(t)?e===t:o.equalByValue(e,t)},_clearSelection:function(e,t,s,i){return e=e||[],e=Array.isArray(e)?e:[e],this.validate(),this.selectedItemKeys(e,t,s,i)},_loadFilteredData:function(e,t,s){var o=encodeURI(JSON.stringify(e)).length,r=this.options.maxFilterLengthInRequest&&o>this.options.maxFilterLengthInRequest,a=new l,d={filter:r?void 0:e,select:r?this.options.dataFields():s||this.options.dataFields()};return e&&0===e.length?a.resolve([]):this.options.load(d).done((function(s){var o=n.isPlainObject(s)?s.data:s;t?o=o.filter(t):r&&(o=i(o).filter(e).toArray()),a.resolve(o)})).fail(a.reject.bind(a)),a},updateSelectedItemKeyHash:function(e){for(var t=0;t<e.length;t++){var s=r(e[t]),i;if(!n.isObject(s))this.options.keyHashIndices[s]=this.options.keyHashIndices[s]||[],this.options.keyHashIndices[s].push(t)}},_isAnyItemSelected:function(e){for(var t=0;t<e.length;t++)if(this.options.isItemSelected(e[t]))return;return!1},_getFullSelectAllState:function(){var e=this.options.plainItems(),t=this.options.filter(),s=this.options.selectedItems;t&&(s=i(s).filter(t).toArray());var o=s.length;return o?o>=this.options.totalCount()||void 0:this._isAnyItemSelected(e)},_getVisibleSelectAllState:function(){for(var e=this.options.plainItems(),t=!1,s=!1,i=0;i<e.length;i++){var o=e[i],n=this.options.getItemData(o),r=this.options.keyOf(n);this.options.isSelectableItem(o)&&(this.isItemKeySelected(r)?t=!0:s=!0)}return!!t&&(!s||void 0)}})}

