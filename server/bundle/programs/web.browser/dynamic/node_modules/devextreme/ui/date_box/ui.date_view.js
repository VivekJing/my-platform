function module(e,t,o){"use strict";var r=e("../../core/renderer"),a=e("../editor/editor"),i=e("./ui.date_view_roller"),s=e("../../core/utils/date"),l=e("../../core/utils/iterator").each,n=e("../../core/utils/extend").extend,d=e("./ui.date_utils"),c=e("../../core/component_registrator"),h=e("../../localization/date"),u="dx-dateview",_="dx-dateview-compact",p="dx-dateview-wrapper",g="dx-dateview-rollers",f="dx-dateviewroller",m="date",v="datetime",C="time",D="year",x="month",R="day",w="hours",I=a.inherit({_valueOption:function(){var e=this.option("value"),t=new Date(e);return!e||isNaN(t)?this._getDefaultDate():t},_getDefaultDate:function(){var e=new Date;return this.option("type")===m?new Date(e.getFullYear(),e.getMonth(),e.getDate()):e},_getDefaultOptions:function(){return n(this.callBase(),{minDate:d.MIN_DATEVIEW_DEFAULT_DATE,maxDate:d.MAX_DATEVIEW_DEFAULT_DATE,type:m,value:new Date,showNames:!1,applyCompactClass:!1})},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(e){return"win"===e.platform&&e.version&&8===e.version[0]},options:{showNames:!0}},{device:function(e){return"desktop"!==e.deviceType},options:{applyCompactClass:!0}}])},_render:function(){this.callBase(),this.$element().addClass("dx-dateview"),this._toggleFormatClasses(this.option("type")),this._toggleCompactClass()},_toggleFormatClasses:function(e,t){this.$element().addClass("dx-dateview-"+e),t&&this.$element().removeClass("dx-dateview-"+t)},_toggleCompactClass:function(){this.$element().toggleClass("dx-dateview-compact",this.option("applyCompactClass"))},_wrapper:function(){return this._$wrapper},_renderContentImpl:function(){this._$wrapper=r("<div>").addClass("dx-dateview-wrapper"),this._renderRollers(),this._$wrapper.appendTo(this.$element())},_renderRollers:function(){this._$rollersContainer||(this._$rollersContainer=r("<div>").addClass("dx-dateview-rollers")),this._$rollersContainer.empty(),this._createRollerConfigs(),this._rollers={};var e=this;l(e._rollerConfigs,(function(t){var o=r("<div>").appendTo(e._$rollersContainer).addClass("dx-dateviewroller-"+e._rollerConfigs[t].type);e._rollers[e._rollerConfigs[t].type]=e._createComponent(o,i,{items:e._rollerConfigs[t].displayItems,selectedIndex:e._rollerConfigs[t].selectedIndex,showScrollbar:!1,onStart:function(o){var r=o.component;r._toggleActive(!0),e._setActiveRoller(e._rollerConfigs[t],r.option("selectedIndex"))},onEnd:function(e){var t;e.component._toggleActive(!1)},onClick:function(o){var r=o.component;r._toggleActive(!0),e._setActiveRoller(e._rollerConfigs[t],r.option("selectedIndex")),e._setRollerState(e._rollerConfigs[t],r.option("selectedIndex")),r._toggleActive(!1)},onSelectedIndexChanged:function(o){var r=o.component;e._setRollerState(e._rollerConfigs[t],r.option("selectedIndex"))}})})),e._$rollersContainer.appendTo(e._wrapper())},_createRollerConfigs:function(e){var t=this;e=e||t.option("type"),t._rollerConfigs={},h.getFormatParts(d.FORMATS_MAP[e]).forEach((function(e){t._createRollerConfig(e)}))},_createRollerConfig:function(e){for(var t=d.DATE_COMPONENTS_INFO[e],o=this._calculateRollerConfigValueRange(e),r=o.startValue,a=o.endValue,i=t.formatter,s=this.option("showNames"),l=this._getCurrentDate(),n={type:e,setValue:t.setter,valueItems:[],displayItems:[],getIndex:function(e){return e[t.getter]()-r}},c=r;c<=a;c++)n.valueItems.push(c),n.displayItems.push(i(c,s,l));n.selectedIndex=n.getIndex(l),this._rollerConfigs[e]=n},_setActiveRoller:function(e){var t=e&&this._rollers[e.type];l(this._rollers,(function(){this.toggleActiveState(this===t)}))},_updateRollersPosition:function(){var e=this;l(this._rollers,(function(t){var o=e._rollerConfigs[t].getIndex(e._getCurrentDate());this.option("selectedIndex",o)}))},_setRollerState:function(e,t){if(t!==e.selectedIndex){var o=e.valueItems[t],r=e.setValue,a=new Date(this._getCurrentDate()),i=a.getDate();e.type===x?i=Math.min(i,d.getMaxMonthDay(a.getFullYear(),o)):e.type===D&&(i=Math.min(i,d.getMaxMonthDay(o,a.getMonth()))),a.setDate(i),a[r](o),a=s.normalizeDate(a,this.option("minDate"),this.option("maxDate")),this.option("value",a),e.selectedIndex=t}e.type===D&&this._refreshRollers(),e.type===x&&(this._refreshRoller(R),this._refreshRoller(w))},_refreshRoller:function(e){var t=this._rollers[e];if(t){this._createRollerConfig(e);var o=this._rollerConfigs[e];e!==R&&o.displayItems.toString()===t.option("items").toString()||t.option({items:o.displayItems,selectedIndex:o.selectedIndex})}},_getCurrentDate:function(){var e=this._valueOption(),t=this.option("minDate"),o=this.option("maxDate");return t&&e.getTime()<=t.getTime()?e=t:o&&e.getTime()>=o.getTime()&&(e=o),e},_calculateRollerConfigValueRange:function(e){var t=this._getCurrentDate(),o=this.option("minDate"),r=this.option("maxDate"),a=s.sameYear(t,o),i=a&&t.getMonth()===o.getMonth(),l=s.sameYear(t,r),n=l&&t.getMonth()===r.getMonth(),c=i&&t.getDate()===o.getDate(),h=n&&t.getDate()===r.getDate(),u=d.DATE_COMPONENTS_INFO[e],_=u.startValue,p=u.endValue;return e===D&&(_=o.getFullYear(),p=r.getFullYear()),e===x&&(a&&(_=o.getMonth()),l&&(p=r.getMonth())),e===R&&(p=d.getMaxMonthDay(t.getFullYear(),t.getMonth()),a&&i&&(_=o.getDate()),l&&n&&(p=r.getDate())),e===w&&(_=c?o.getHours():_,p=h?r.getHours():p),{startValue:_,endValue:p}},_refreshRollers:function(){this._refreshRoller(x),this._refreshRoller(R),this._refreshRoller(w)},_optionChanged:function(e){switch(e.name){case"showNames":case"minDate":case"maxDate":case"type":this._renderRollers(),this._toggleFormatClasses(e.value,e.previousValue);break;case"visible":this.callBase(e),e.value&&this._renderRollers();break;case"value":this.option("value",this._valueOption()),this._refreshRollers(),this._updateRollersPosition();break;default:this.callBase(e)}},_clean:function(){this.callBase(),delete this._$rollersContainer},_dispose:function(){clearTimeout(this._deferredRenderDayTimeout),clearTimeout(this._deferredRenderMonthTimeout),this.callBase()}});c("dxDateView",I),o.exports=I}

