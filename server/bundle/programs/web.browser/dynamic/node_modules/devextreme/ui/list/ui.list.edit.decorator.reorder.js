function module(t){"use strict";var i=t("../../core/renderer"),s=t("../../core/utils/iterator").each,e=t("../../events/core/events_engine"),n=t("../../animation/translator"),o=t("../../animation/fx"),r=t("../../events/drag"),a=t("../../core/utils/math"),h=t("../scroll_view/animator"),l=t("../../events/utils"),_=t("./ui.list.edit.decorator_registry").register,d=t("./ui.list.edit.decorator"),c=h.inherit({ctor:function(t){this.callBase(),this._strategy=t},_isFinished:function(){return this._strategy.scrollFinished()},_step:function(){this._strategy.scrollByStep()}}),m="dxListEditDecorator",u=l.addNamespace(r.start,m),g=l.addNamespace(r.move,m),f=l.addNamespace(r.end,m),p="dx-list-reorder-handle-container",I="dx-list-reorder-handle",P="dx-list-item-reordering",x="dx-list-item-ghost-reordering";_("reorder","default",d.inherit({_init:function(){this._groupedEnabled=this._list.option("grouped"),this._initAnimator()},_initAnimator:function(){this._scrollAnimator=new c(this)},_startAnimator:function(){this._scrollAnimator.inProgress()||this._scrollAnimator.start()},_stopAnimator:function(){this._scrollAnimator.stop()},afterBag:function(t){var s=t.$itemElement,n=t.$container,o=i("<div>").addClass(I),r=!1;e.on(o,"dxpointerdown",(function(t){r=!l.isMouseEvent(t)})),e.on(o,"dxhold",{timeout:30},(function(t){t.cancel=!0,r=!1})),e.on(o,u,{direction:"vertical",immediate:!0},function(t){r?t.cancel=!0:this._dragStartHandler(s,t)}.bind(this)),e.on(o,g,this._dragHandler.bind(this,s)),e.on(o,f,this._dragEndHandler.bind(this,s)),n.addClass(p),n.append(o)},_dragStartHandler:function(t,i){if(t.is(".dx-state-disabled, .dx-state-disabled *"))i.cancel=!0;else{this._stopPreviousAnimation(),i.targetElements=[],this._cacheItemsPositions(),this._startPointerOffset=i.pageY-t.offset().top,this._elementHeight=t.outerHeight();var s=this._list.getFlatIndexByItemElement(t);this._startIndex=s,this._lastIndex=s,this._cacheScrollData();var e=this;this._createGhostTimeout=setTimeout((function(){e._createGhost(t),e._updateGhostPosition(),t.addClass(P)}))}},_stopPreviousAnimation:function(){o.stop(this._$ghostItem,!0)},_cacheItemsPositions:function(){var t=this._itemPositions=[];s(this._list.itemElements(),(function(s,e){var n=null;t.push((function(){return n=null===n?i(e).position().top:n}))}))},_getDraggingElementPosition:function(){return this._itemPositions[this._startIndex]()},_getLastElementPosition:function(){return this._itemPositions[this._lastIndex]()},_cacheScrollData:function(){this._list.updateDimensions(),this._startScrollTop=this._list.scrollTop(),this._scrollOffset=0,this._scrollHeight=this._list.scrollHeight(),this._clientHeight=this._list.clientHeight()},_scrollTop:function(){return this._startScrollTop+this._scrollOffset},_createGhost:function(t){this._$ghostItem=t.clone(),this._$ghostItem.addClass(x).appendTo(this._list.itemsContainer()),this._startGhostPosition=this._getDraggingElementPosition()-this._$ghostItem.position().top,n.move(this._$ghostItem,{top:this._startGhostPosition})},_dragHandler:function(t,i){this._topOffset=i.offset.y,this._updateItemPositions();var s=this._getPointerPosition();this._toggleScroll(s)},_getPointerPosition:function(){return this._getDraggingElementPosition()+this._startPointerOffset+this._scrollOffset+this._topOffset},_toggleScroll:function(t){if(!(this._scrollHeight<=this._clientHeight)){var i=.7*this._elementHeight,s,e=(this._clientHeight-(t-this._scrollTop()))/i,n,o=(t-this._scrollTop())/i;e<1?(this._stepSize=this._adjustRationIntoRange(e),this._startAnimator()):o<1?(this._stepSize=-this._adjustRationIntoRange(o),this._startAnimator()):this._stopAnimator()}},_adjustRationIntoRange:function(t){return a.fitIntoRange(Math.round(7*Math.abs(t-1)),1,7)},_updateItemPositions:function(){this._updateGhostPosition(),this._updateOthersPositions()},_updateGhostPosition:function(){this._$ghostItem&&n.move(this._$ghostItem,{top:this._startGhostPosition+this._scrollOffset+this._topOffset})},_updateOthersPositions:function(){var t=this._findItemIndexByPosition(this._getPointerPosition());if(this._lastIndex!==t&&(!this._groupedEnabled||this._sameParent(t))){for(var i=t-this._startIndex,s=a.sign(i),e=Math.min(t,this._lastIndex),n=Math.max(t,this._lastIndex),r=e;r<=n;r++)if(r!==this._startIndex){var h=this._list.getItemElementByFlatIndex(r),l=r-this._startIndex,_=a.sign(l),d=Math.abs(l)<=Math.abs(i),c=s===_,m=d&&c,u=!d||!c;o.stop(h),m&&o.animate(h,{type:"slide",to:{top:this._elementHeight*-s},duration:300}),u&&o.animate(h,{type:"slide",to:{top:0},duration:300})}this._lastIndex=t}},_sameParent:function(t){var i=this._list.getItemElementByFlatIndex(this._startIndex),s;return this._list.getItemElementByFlatIndex(t).parent().get(0)===i.parent().get(0)},scrollByStep:function(){this._scrollOffset+=this._stepSize,this._list.scrollBy(this._stepSize),this._updateItemPositions()},scrollFinished:function(){var t=this._scrollTop(),i=t<=0&&this._stepSize<0,s=t>=this._scrollHeight-this._clientHeight&&this._stepSize>0;return i||s},_dragEndHandler:function(t){this._scrollAnimator.stop(),o.animate(this._$ghostItem,{type:"slide",to:{top:this._startGhostPosition+this._getLastElementPosition()-this._getDraggingElementPosition()},duration:300}).done(function(){t.removeClass(P),this._resetPositions(),this._list.reorderItem(t,this._list.getItemElementByFlatIndex(this._lastIndex)),this._deleteGhost()}.bind(this))},_deleteGhost:function(){this._$ghostItem&&this._$ghostItem.remove()},_resetPositions:function(){for(var t=Math.min(this._startIndex,this._lastIndex),i=Math.max(this._startIndex,this._lastIndex),s=t;s<=i;s++){var e=this._list.getItemElementByFlatIndex(s);n.resetPosition(e)}},_findItemIndexByPosition:function(t){for(var i=0,s=this._itemPositions.length-1,e,n;i<=s;)if(e=(i+s)/2|0,(n=this._itemPositions[e]())<t)i=e+1;else{if(!(n>t))return e;s=e-1}return a.fitIntoRange(i,0,Math.max(s,0))},getExcludedSelectors:function(t){t.push(".dx-list-item-ghost-reordering")},dispose:function(){clearTimeout(this._createGhostTimeout),this.callBase.apply(this,arguments)}}))}

