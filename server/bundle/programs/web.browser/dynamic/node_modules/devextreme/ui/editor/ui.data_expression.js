function module(e,t,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=e("../../core/utils/variable_wrapper"),o=e("../../core/utils/data"),n=e("../../core/utils/common"),s=e("../../core/utils/type"),u=e("../../core/utils/extend").extend,l=e("../../data_helper"),p=e("../../data/data_source/data_source"),c=e("../../data/array_store"),m=e("../../core/utils/deferred").Deferred,_=u(l,{_dataExpressionDefaultOptions:function(){return{items:[],dataSource:null,itemTemplate:"item",value:null,valueExpr:"this",displayExpr:void 0}},_initDataExpressions:function(){this._compileValueGetter(),this._compileDisplayGetter(),this._initDynamicTemplates(),this._initDataSource(),this._itemsToDataSource()},_itemsToDataSource:function(){this.option("dataSource")||(this._dataSource=new p.DataSource({store:new c(this.option("items")),pageSize:0}))},_compileDisplayGetter:function(){this._displayGetter=o.compileGetter(this._displayGetterExpr())},_displayGetterExpr:function(){return this.option("displayExpr")},_compileValueGetter:function(){this._valueGetter=o.compileGetter(this._valueGetterExpr())},_valueGetterExpr:function(){return this.option("valueExpr")||"this"},_loadValue:function(e){var t=new m;return e=this._unwrappedValue(e),s.isDefined(e)?(this._loadSingle(this._valueGetterExpr(),e).done(function(i){this._isValueEquals(this._valueGetter(i),e)?t.resolve(i):t.reject()}.bind(this)).fail((function(){t.reject()})),t.promise()):t.reject().promise()},_getCurrentValue:function(){return this.option("value")},_unwrappedValue:function(e){return(e=s.isDefined(e)?e:this._getCurrentValue())&&this._dataSource&&"this"===this._valueGetterExpr()&&(e=this._getItemKey(e)),a.unwrap(e)},_getItemKey:function(e){var t=this._dataSource.key();if(Array.isArray(t)){for(var i={},a=0,o=t.length;a<o;a++)i[t[a]]=e[t[a]];return i}return t&&"object"===(void 0===e?"undefined":r(e))&&(e=e[t]),e},_isValueEquals:function(e,t){var i=this._dataSource&&this._dataSource.key(),r=s.isDefined,a=this._compareValues(e,t);return!a&&i&&r(e)&&r(t)&&(a=Array.isArray(i)?this._compareByCompositeKey(e,t,i):this._compareByKey(e,t,i)),a},_compareByCompositeKey:function(e,t,i){var r=s.isObject;if(!r(e)||!r(t))return!1;for(var a=0,o=i.length;a<o;a++)if(e[i[a]]!==t[i[a]])return!1;return!0},_compareByKey:function(e,t,i){var r=n.ensureDefined,o=a.unwrap,s=r(o(e[i]),e),u=r(o(t[i]),t);return this._compareValues(s,u)},_compareValues:function(e,t){return o.toComparable(e,!0)===o.toComparable(t,!0)},_initDynamicTemplates:n.noop,_setCollectionWidgetItemTemplate:function(){this._initDynamicTemplates(),this._setCollectionWidgetOption("itemTemplate",this.option("itemTemplate"))},_getCollectionKeyExpr:function(){var e=this.option("valueExpr"),t;return s.isString(e)&&"this"!==e||s.isFunction(e)?e:null},_dataExpressionOptionChanged:function(e){switch(e.name){case"items":this._itemsToDataSource(),this._setCollectionWidgetOption("items");break;case"dataSource":this._initDataSource();break;case"itemTemplate":this._setCollectionWidgetItemTemplate();break;case"valueExpr":this._compileValueGetter();break;case"displayExpr":this._compileDisplayGetter(),this._initDynamicTemplates(),this._setCollectionWidgetOption("displayExpr")}}});i.exports=_}

