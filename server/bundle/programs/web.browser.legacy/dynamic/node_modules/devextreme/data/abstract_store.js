function module(e,t,n){"use strict";var r=e("../core/class"),i=r.abstract,o=e("../core/events_mixin"),u=e("../core/utils/iterator").each,s=e("./errors"),d=e("./utils"),a=e("../core/utils/data").compileGetter,f,l=e("./store_helper").queryByOptions,c=e("../core/utils/deferred").Deferred,h=e("../core/utils/common").noop,m={},p=r.inherit({ctor:function(e){var t=this;e=e||{},u(["onLoaded","onLoading","onInserted","onInserting","onUpdated","onUpdating","onPush","onRemoved","onRemoving","onModified","onModifying"],(function(n,r){r in e&&t.on(r.slice(2).toLowerCase(),e[r])})),this._key=e.key,this._errorHandler=e.errorHandler,this._useDefaultSearch=!0},_customLoadOptions:function(){return null},key:function(){return this._key},keyOf:function(e){return this._keyGetter||(this._keyGetter=a(this.key())),this._keyGetter(e)},_requireKey:function(){if(!this.key())throw s.errors.Error("E4005")},load:function(e){var t=this;return e=e||{},this.fireEvent("loading",[e]),this._withLock(this._loadImpl(e)).done((function(n){t.fireEvent("loaded",[n,e])}))},_loadImpl:function(e){return l(this.createQuery(e),e).enumerate()},_withLock:function(e){var t=new c;return e.done((function(){var e=this,n=arguments;d.processRequestResultLock.promise().done((function(){t.resolveWith(e,n)}))})).fail((function(){t.rejectWith(this,arguments)})),t},createQuery:i,totalCount:function(e){return this._totalCountImpl(e)},_totalCountImpl:function(e){return l(this.createQuery(e),e,!0).count()},byKey:function(e,t){return this._addFailHandlers(this._withLock(this._byKeyImpl(e,t)))},_byKeyImpl:i,insert:function(e){var t=this;return t.fireEvent("modifying"),t.fireEvent("inserting",[e]),t._addFailHandlers(t._insertImpl(e).done((function(e,n){t.fireEvent("inserted",[e,n]),t.fireEvent("modified")})))},_insertImpl:i,update:function(e,t){var n=this;return n.fireEvent("modifying"),n.fireEvent("updating",[e,t]),n._addFailHandlers(n._updateImpl(e,t).done((function(){n.fireEvent("updated",[e,t]),n.fireEvent("modified")})))},_updateImpl:i,push:function(e){this._pushImpl(e),this.fireEvent("push",[e])},_pushImpl:h,remove:function(e){var t=this;return t.fireEvent("modifying"),t.fireEvent("removing",[e]),t._addFailHandlers(t._removeImpl(e).done((function(e){t.fireEvent("removed",[e]),t.fireEvent("modified")})))},_removeImpl:i,_addFailHandlers:function(e){return e.fail(this._errorHandler).fail(s._errorHandler)}}).include(o),_;p.create=function(e,t){if(!(e in m))throw s.errors.Error("E4020",e);return new m[e](t)},p.inherit=(_=p.inherit,function(e,t){var n=_.apply(this,[e]);return t&&(m[t]=n),n}),n.exports=p}

