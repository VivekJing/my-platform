function module(t,e,i){"use strict";var a=t("../../core/renderer"),s=t("../../core/utils/window"),n=s.getWindow(),o=t("../../core/component_registrator"),r=t("../../core/utils/type"),l=t("../../core/utils/dom"),p=t("../../core/utils/iterator").each,d=t("../../core/utils/version").compare,u=t("../../core/utils/extend").extend,h=t("../../core/utils/support"),c=t("../../core/devices"),_=t("../../core/config"),m=t("../../core/utils/date"),g=t("./ui.date_utils"),y=t("../../core/utils/date_serialization"),f=t("../drop_down_editor/ui.drop_down_editor"),v=t("../../localization/date"),x=t("../../localization/message"),b="dx-datebox",D="dx-auto-width",T="dx-datebox-wrapper",C={calendar:"calendar",rollers:"rollers",list:"list",native:"native"},B={date:"date",datetime:"datetime",time:"time"},w="Calendar",O="DateView",S="Native",k="CalendarWithTime",V="List",P={Calendar:t("./ui.date_box.strategy.calendar"),DateView:t("./ui.date_box.strategy.date_view"),Native:t("./ui.date_box.strategy.native"),CalendarWithTime:t("./ui.date_box.strategy.calendar_with_time"),List:t("./ui.date_box.strategy.list")},F=function(t){var e=t[0].style.width;return!(!e||"auto"===e||"inherit"===e)},z=function(t,e,i){var a=10,s=48,o=l.createTextElementHiddenCopy(e,t);o.appendTo(i);var r,p,d,u=parseFloat(n.getComputedStyle(o.get(0)).width)+parseFloat(n.getComputedStyle(e.get(0)).paddingRight)+parseFloat(n.getComputedStyle(e.get(0)).paddingLeft)+10+("text"!==e.prop("type")?48:0);return o.remove(),u},L=f.inherit({_supportedKeys:function(){return u(this.callBase(),this._strategy.supportedKeys())},_setDeprecatedOptions:function(){this.callBase(),u(this._deprecatedOptions,{maxZoomLevel:{since:"18.1",alias:"calendarOptions.maxZoomLevel"},minZoomLevel:{since:"18.1",alias:"calendarOptions.minZoomLevel"}})},_getDefaultOptions:function(){return u(this.callBase(),{type:"date",showAnalogClock:!0,value:null,dateSerializationFormat:void 0,min:void 0,max:void 0,displayFormat:null,interval:30,disabledDates:null,maxZoomLevel:"month",minZoomLevel:"century",pickerType:C.calendar,invalidDateMessage:x.format("dxDateBox-validation-datetime"),dateOutOfRangeMessage:x.format("validation-range"),applyButtonText:x.format("Done"),adaptivityEnabled:!1,calendarOptions:{}})},_defaultOptionsRules:function(){return this.callBase().concat([{device:{platform:"ios"},options:{showPopupTitle:!0}},{device:{platform:"android"},options:{buttonsLocation:"bottom after"}},{device:function(){var t,e=c.real().platform;return"ios"===e||"android"===e},options:{pickerType:C.native}},{device:function(t){return"win"===t.platform&&t.version&&8===t.version[0]},options:{buttonsLocation:"bottom after"}},{device:function(t){return"win"===t.platform&&t.version&&10===t.version[0]},options:{buttonsLocation:"bottom center"}},{device:function(t){var e=c.real(),i=e.platform,a=e.version,s=e.phone;return"generic"===i&&"desktop"!==t.deviceType||"win"===i&&s||"android"===i&&d(a,[4,4])<0},options:{pickerType:C.rollers}},{device:{platform:"generic",deviceType:"desktop"},options:{buttonsLocation:"bottom after"}}])},_initOptions:function(t){this._userOptions=u({},t),this.callBase(t),this._updatePickerOptions()},_updatePickerOptions:function(){var t=this.option("pickerType"),e=this.option("type");t!==C.list||e!==B.datetime&&e!==B.date||(t=C.calendar),e===B.time&&t===C.calendar&&(t=C.list),this.option("showDropDownButton","generic"!==c.real().platform||t!==C.native),this._pickerType=t},_init:function(){this._initStrategy(),this.option(u({},this._strategy.getDefaultOptions(),this._userOptions)),delete this._userOptions,this.callBase()},_toLowerCaseFirstLetter:function(t){return t.charAt(0).toLowerCase()+t.substr(1)},_initStrategy:function(){var t=this._getStrategyName(this._getFormatType()),e=P[t];this._strategy&&this._strategy.NAME===t||(this._strategy=new e(this))},_getFormatType:function(){var t=this.option("type"),e=/h|m|s/g.test(t),i,a="";return/d|M|Y/g.test(t)&&(a+=B.date),e&&(a+=B.time),a},_getStrategyName:function(t){var e=this._pickerType;return e===C.rollers?O:e===C.native?S:t===B.date?w:t===B.datetime?k:V},_initMarkup:function(){this.$element().addClass("dx-datebox"),this._renderSubmitElement(),this.callBase(),this._refreshFormatClass(),this._refreshPickerTypeClass(),this._strategy.renderInputMinMax(this._input())},_render:function(){this.callBase(),this._updateSize()},_renderDimensions:function(){this.callBase(),this.$element().toggleClass("dx-auto-width",!this.option("width"))},_refreshFormatClass:function(){var t=this.$element();p(B,(function(e,i){t.removeClass("dx-datebox-"+i)})),t.addClass("dx-datebox-"+this.option("type"))},_refreshPickerTypeClass:function(){var t=this.$element();p(C,(function(e,i){t.removeClass("dx-datebox-"+i)})),t.addClass("dx-datebox-"+this._pickerType)},_renderSubmitElement:function(){this._$submitElement=a("<input>").attr("type","hidden").appendTo(this.$element())},_getSubmitElement:function(){return this._$submitElement},_updateSize:function(){var t=this.$element(),e=this.option("width"),i=r.isDefined(e)||F(t)&&!this._isSizeUpdatable,a,n=this._pickerType!==C.rollers&&"generic"===c.current().platform;if(s.hasWindow()&&!i&&n&&t.is(":visible")){var o=this._input(),l=this._strategy.getDisplayFormat(this.option("displayFormat")),p=v.format(g.getLongestDate(l,v.getMonthNames(),v.getDayNames()),l);t.width(z(p,o,this.$element())),this._isSizeUpdatable=!0}},_attachChildKeyboardEvents:function(){this._strategy.attachKeyboardEvents(this._keyboardProcessor)},_renderPopup:function(){this.callBase(),this._popup._wrapper().addClass("dx-datebox-wrapper"),this._renderPopupWrapper()},_popupConfig:function(){var t=this.callBase();return u(this._strategy.popupConfig(t),{title:this._getPopupTitle(),dragEnabled:!1})},_renderPopupWrapper:function(){if(this._popup){var t=this.$element(),e=u({},B,C);p(e,function(e,i){t.removeClass("dx-datebox-wrapper-"+i)}.bind(this)),this._popup._wrapper().addClass("dx-datebox-wrapper-"+this.option("type")).addClass("dx-datebox-wrapper-"+this._pickerType)}},_renderPopupContent:function(){this.callBase(),this._strategy.renderPopupContent()},_getFirstPopupElement:function(){return this._strategy.getFirstPopupElement()||this.callBase()},_getLastPopupElement:function(){return this._strategy.getLastPopupElement()||this.callBase()},_popupShowingHandler:function(){this.callBase(),this._strategy.popupShowingHandler()},_popupHiddenHandler:function(){this.callBase(),this._strategy.popupHiddenHandler()},_visibilityChanged:function(t){t&&this._updateSize()},_clearValueHandler:function(t){this.option("text",""),this.callBase(t)},_readOnlyPropValue:function(){return this.callBase()&&!this._isNativeType()||this._pickerType===C.rollers},_clearButtonVisibility:function(){return this.callBase()&&!this._isNativeType()},_renderValue:function(){var t=this.dateOption("value"),e=this.option("dateSerializationFormat");this.option("text",this._getDisplayedText(t));var i=g.SUBMIT_FORMATS_MAP[this.option("type")],a=e?y.serializeDate(t,e):g.toStandardDateFormat(t,i);this._$submitElement.val(a),this._strategy.renderValue(),this.callBase()},_getDisplayedText:function(t){var e,i=this.option("mode");if("text"===i){var a=this._strategy.getDisplayFormat(this.option("displayFormat"));e=v.format(t,a)}else{var s=this._getFormatByMode(i);e=s?v.format(t,s):g.toStandardDateFormat(t,i)}return e},_getFormatByMode:function(t){return h.inputType(t)?null:g.FORMATS_MAP[t]},_valueChangeEventHandler:function(t){var e=this.option("text"),i=this.dateOption("value");if(e!==this._getDisplayedText(i)){var a=this._getParsedDate(e),s=i||this._getDateByDefault(),n=this.option("type"),o=g.mergeDates(s,a,n),r=a&&"time"===n?o:a;if(this._applyInternalValidation(r)){var l=this._getDisplayedText(o);s&&o&&s.getTime()===o.getTime()&&l!==e?this._renderValue():this.dateValue(o,t)}this._applyCustomValidation(o)}else this._validateValue(i)},_getDateByDefault:function(){return this._strategy.useCurrentDateByDefault()&&new Date},_getParsedDate:function(t){var e=this._strategy.getDisplayFormat(this.option("displayFormat")),i=this._strategy.getParsedText(t,e);return r.isDefined(i)?i:void 0},_validateValue:function(t){return this._applyInternalValidation(t)&&this._applyCustomValidation(t)},_applyInternalValidation:function(t){var e,i=!!this.option("text")&&null!==t,a=!!t&&r.isDate(t)&&!isNaN(t.getTime()),s=a&&m.dateInRange(t,this.dateOption("min"),this.dateOption("max"),this.option("type")),n=!i&&!t||s,o="";return a?s||(o=this.option("dateOutOfRangeMessage")):o=this.option("invalidDateMessage"),this.option({isValid:n,validationError:n?null:{editorSpecific:!0,message:o}}),n},_applyCustomValidation:function(t){return this.validationRequest.fire({editor:this,value:t}),this.option("isValid")},_isValueChanged:function(t){var e=this.dateOption("value"),i,a;return(e&&e.getTime())!==(t&&t.getTime())},_isTextChanged:function(t){var e,i;return this.option("text")!==(t&&this._getDisplayedText(t)||"")},_renderProps:function(){this.callBase(),this._input().attr("autocomplete","off")},_renderOpenedState:function(){this._isNativeType()||this.callBase(),this._strategy.isAdaptivityChanged()&&this._refreshStrategy(),this._strategy.renderOpenedState()},_getPopupTitle:function(){var t=this.option("placeholder");if(t)return t;var e=this.option("type");return e===B.time?x.format("dxDateBox-simulatedDataPickerTitleTime"):e===B.date||e===B.datetime?x.format("dxDateBox-simulatedDataPickerTitleDate"):""},_renderPlaceholder:function(){this._popup&&this._popup.option("title",this._getPopupTitle()),this.callBase()},_refreshStrategy:function(){this._strategy.dispose(),this._initStrategy(),this.option(this._strategy.getDefaultOptions()),this._refresh()},_applyButtonHandler:function(t){var e=this._strategy.getValue();this._validateValue(e)&&this.dateValue(e,t.event),this.callBase()},_dispose:function(){this._strategy&&this._strategy.dispose(),this.callBase()},_isNativeType:function(){return this._pickerType===C.native},_optionChanged:function(t){switch(t.name){case"showClearButton":this.callBase.apply(this,arguments),this._updateSize();break;case"pickerType":this._updatePickerOptions({pickerType:t.value}),this._refreshStrategy(),this._refreshPickerTypeClass(),this._invalidate();break;case"type":this._updatePickerOptions({format:t.value}),this._refreshStrategy(),this._refreshFormatClass(),this._renderPopupWrapper(),this._updateSize();break;case"placeholder":this._renderPlaceholder();break;case"min":case"max":this._applyInternalValidation(this.dateOption("value")),this._invalidate();break;case"dateSerializationFormat":case"interval":case"disabledDates":case"calendarOptions":case"minZoomLevel":case"maxZoomLevel":this._invalidate();break;case"displayFormat":this.option("text",this._getDisplayedText(this.dateOption("value"))),this._renderInputValue();break;case"formatWidthCalculator":break;case"closeOnValueChange":var e=t.value?"instantly":"useButtons";this.option("applyValueMode",e);break;case"applyValueMode":this._suppressDeprecatedWarnings(),this.option("closeOnValueChange","instantly"===t.value),this._resumeDeprecatedWarnings(),this.callBase.apply(this,arguments);break;case"text":this._strategy.textChangedHandler(t.value),this.callBase.apply(this,arguments);break;case"isValid":this.callBase.apply(this,arguments),this._updateSize();break;case"showDropDownButton":case"invalidDateMessage":case"dateOutOfRangeMessage":case"adaptivityEnabled":case"showAnalogClock":break;default:this.callBase.apply(this,arguments)}},_getSerializationFormat:function(){var t=this.option("value");return this.option("dateSerializationFormat")&&_().forceIsoDateParsing?this.option("dateSerializationFormat"):r.isNumeric(t)?"number":r.isString(t)?y.getDateSerializationFormat(t):void 0},_updateValue:function(t){this.callBase(),this._validateValue(t||this.dateOption("value"))},dateValue:function(t,e){var i=this._isValueChanged(t);return i&&e&&this._saveValueChangeEvent(e),!i&&this._isTextChanged(t)&&this._updateValue(t),this.dateOption("value",t)},dateOption:function(t,e){if(1===arguments.length)return y.deserializeDate(this.option(t));var i=this._getSerializationFormat();this.option(t,y.serializeDate(e,i))},reset:function(){this.callBase(),this._updateValue(this.dateOption("value"))}});o("dxDateBox",L),i.exports=L}

