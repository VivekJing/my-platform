function module(t,e,i){"use strict";var s=t("../core/renderer"),n=t("../events/core/events_engine"),o=t("../core/utils/common"),l=t("../core/utils/type"),a=l.isDefined,r=l.isPromise,u=t("../core/utils/extend").extend,h=t("../core/utils/array").inArray,c=t("../core/utils/iterator").each,p=t("../core/utils/deferred"),d=t("../core/utils/dom").getPublicElement,_=p.Deferred,m=t("../core/errors"),f=t("../core/dom_adapter"),v=t("./widget/utils.ink_ripple"),I=t("../localization/message"),g=t("../core/component_registrator"),C=t("../events/utils"),S=t("./drop_down_editor/ui.drop_down_list"),b=t("./themes"),V=t("../events/click"),E=".dx-state-disabled",w="dx-selectbox",x="dx-selectbox-popup",y="dx-selectbox-container",B="dx-selectbox-popup-wrapper",A=S.inherit({_supportedKeys:function(){var t=this,e=this.callBase(),i=function(t){var e;this._isEditable()?this._valueSubstituted()&&(this._preventFiltering=!0):this.option("showClearButton")&&(t.preventDefault(),this.reset()),this._preventSubstitution=!0},s=function(){t.option("searchEnabled")&&t._valueSubstituted()&&t._searchHandler()};return u({},e,{tab:function(){this.option("opened")&&"instantly"===this.option("applyValueMode")&&this._cleanInputSelection(),this._wasSearch()&&this._clearFilter(),e.tab&&e.tab.apply(this,arguments)},upArrow:function(){if(e.upArrow&&e.upArrow.apply(this,arguments))return this.option("opened")||this._setNextValue(-1),!0},downArrow:function(){if(e.downArrow&&e.downArrow.apply(this,arguments))return this.option("opened")||this._setNextValue(1),!0},leftArrow:function(){s(),e.leftArrow&&e.leftArrow.apply(this,arguments)},rightArrow:function(){s(),e.rightArrow&&e.rightArrow.apply(this,arguments)},home:function(){s(),e.home&&e.home.apply(this,arguments)},end:function(){s(),e.end&&e.end.apply(this,arguments)},escape:function(){e.escape&&e.escape.apply(this,arguments),this._cancelEditing()},enter:function(t){var i=this.option("opened"),s=this._input().val().trim(),n=s&&this._list&&!this._list.option("focusedElement");if(!s&&this.option("value")&&this.option("allowClearing"))this.option({selectedItem:null,value:null}),this.close();else{if(this.option("acceptCustomValue"))return t.preventDefault(),n&&(this._valueChangeEventHandler(),i&&this._toggleOpenState()),i;if(e.enter&&e.enter.apply(this,arguments))return i}},space:function(t){var e=this.option("opened"),i=this.option("searchEnabled"),s=this.option("acceptCustomValue");if(e&&!i&&!s)return t.preventDefault(),this._valueChangeEventHandler(t),!0},backspace:i,del:i})},_getDefaultOptions:function(){return u(this.callBase(),{placeholder:I.format("Select"),fieldTemplate:null,valueChangeEvent:"change",acceptCustomValue:!1,onCustomItemCreating:function(t){a(t.customItem)||(t.customItem=t.text)},showSelectionControls:!1,autocompletionEnabled:!0,allowClearing:!0,tooltipEnabled:!1,openOnFieldClick:!0,showDropDownButton:!0,displayCustomValue:!1,_isAdaptablePopupPosition:!1,useInkRipple:!1})},_defaultOptionsRules:function(){var t=b.current();return this.callBase().concat([{device:function(){return b.isWin8(t)},options:{_isAdaptablePopupPosition:!0,popupPosition:{at:"left top",offset:{h:0,v:0}}}},{device:function(){return b.isAndroid5(t)},options:{_isAdaptablePopupPosition:!0,popupPosition:{offset:{h:-16,v:-8}},useInkRipple:!0}}])},_init:function(){this.callBase(),this._initCustomItemCreatingAction()},_initMarkup:function(){this._renderSubmitElement(),this.$element().addClass("dx-selectbox"),this._renderTooltip(),this.option("useInkRipple")&&this._renderInkRipple(),this.callBase(),this._$container.addClass("dx-selectbox-container")},_renderSubmitElement:function(){this._$submitElement=s("<input>").attr("type","hidden").appendTo(this.$element())},_renderInkRipple:function(){this._inkRipple=v.render()},_toggleActiveState:function(t,e,i){if(this.callBase.apply(this,arguments),this._inkRipple&&!this._isEditable()){var s={element:this._inputWrapper(),event:i};e?this._inkRipple.showWave(s):this._inkRipple.hideWave(s)}},_createPopup:function(){this.callBase(),this._popup.$element().addClass("dx-selectbox-popup")},_popupWrapperClass:function(){return this.callBase()+" dx-selectbox-popup-wrapper"},_cancelEditing:function(){!this.option("searchEnabled")&&this._list&&(this._focusListElement(null),this._updateField(this.option("selectedItem")))},_renderOpenedState:function(){this.callBase(),this.option("opened")&&(this._scrollToSelectedItem(),this._focusSelectedElement())},_focusSelectedElement:function(){var t;if(this._searchValue()){var e=this._list._itemElements(),i=h(this.option("selectedItem"),this.option("items")),s=i>=0&&!this._isCustomItemSelected()?e.eq(i):null;this._focusListElement(s)}else this._focusListElement(null)},_renderFocusedElement:function(){var t;if(this._list)if(this._searchValue()&&!this.option("acceptCustomValue")){var e,i=this._list._itemElements().not(".dx-state-disabled").eq(0);this._focusListElement(i)}else this._focusListElement(null)},_focusListElement:function(t){this._preventInputValueRender=!0,this._list.option("focusedElement",d(t)),delete this._preventInputValueRender},_scrollToSelectedItem:function(){this._list&&this._list.scrollToItem(this._list.option("selectedItem"))},_listContentReadyHandler:function(){var t;this.callBase(),this._dataSource&&this._dataSource.paginate()&&this._needPopupRepaint()||this._scrollToSelectedItem()},_renderValue:function(){this._renderInputValue(),this._setSubmitValue()},_setSubmitValue:function(){var t=this.option("value"),e="this"===this.option("valueExpr")?this._displayGetter(t):t;this._$submitElement.val(e)},_getSubmitElement:function(){return this._$submitElement},_renderInputValue:function(){return this.callBase().always(function(){this._renderInputValueAsync()}.bind(this))},_renderInputValueAsync:function(){this._renderTooltip(),this._renderInputValueImpl().always(function(){this._refreshSelected()}.bind(this))},_renderInputValueImpl:function(){return this._renderInputAddons(),(new _).resolve()},_setNextItem:function(t){var e=this._calcNextItem(t),i=this._valueGetter(e);this._setValue(i)},_setNextValue:function(t){var e;(this._dataSource.isLoaded()?(new _).resolve():this._dataSource.load()).done(function(){var e=this._getSelectedIndex(),i=this._dataSource.pageSize(),s=this._dataSource.isLastPage(),n=e===this._items().length-1;i&&!s&&n&&t>0?(this._popup||this._createPopup(),this._list._loadNextPage().done(this._setNextItem.bind(this,t))):this._setNextItem(t)}.bind(this))},_setSelectedItem:function(t){var e=!this._isCustomValueAllowed()&&void 0===t;this.callBase(e?null:t)},_isCustomValueAllowed:function(){return this.option("acceptCustomValue")||this.callBase()},_displayValue:function(t){return t=!a(t)&&this._isCustomValueAllowed()?this.option("value"):t,this.callBase(t)},_listConfig:function(){var t=u(this.callBase(),{pageLoadMode:"scrollBottom",onSelectionChanged:this._getSelectionChangeHandler(),selectedItem:this.option("selectedItem"),onFocusedItemChanged:this._listFocusedItemChangeHandler.bind(this)});return this.option("showSelectionControls")&&u(t,{showSelectionControls:!0,selectionByClick:!0}),t},_listFocusedItemChangeHandler:function(t){if(!this._preventInputValueRender){var e=t.component,i=s(e.option("focusedElement")),n=e._getItemData(i);this._updateField(n)}},_updateField:function(t){var e;this._getTemplateByOption("fieldTemplate")&&this.option("fieldTemplate")?this._renderInputAddons():this._renderDisplayText(this._displayGetter(t))},_getSelectionChangeHandler:function(){return this.option("showSelectionControls")?this._selectionChangeHandler.bind(this):o.noop},_selectionChangeHandler:function(t){c(t.addedItems||[],function(t,e){this._setValue(this._valueGetter(e))}.bind(this))},_getActualSearchValue:function(){return this._dataSource.searchValue()},_toggleOpenState:function(t){if(!this.option("disabled")){if((t=arguments.length?t:!this.option("opened"))||this._restoreInputText(),this._wasSearch()&&t){this._wasSearch(!1);var e=this.option("showDataBeforeSearch")||0===this.option("minSearchLength");if(e&&this._dataSource){if(this._searchTimer)return;var i=this._getActualSearchValue();i&&this._wasSearch(!0),this._filterDataSource(i||null)}else this._setListOption("items",[])}t&&this._scrollToSelectedItem(),this.callBase(t)}},_renderTooltip:function(){this.option("tooltipEnabled")&&this.$element().attr("title",this.option("displayValue"))},_renderDimensions:function(){this.callBase(),this._setPopupOption("width")},_isValueEqualInputText:function(){var t=this.option("selectedItem"),e=this._displayGetter(t),i,s;return(e?String(e):"")===this._searchValue()},_popupHidingHandler:function(){this._isValueEqualInputText()&&this._cancelEditing(),this.callBase()},_restoreInputText:function(){this.option("readOnly")||this._loadItemDeferred&&this._loadItemDeferred.always(function(){var t=this.option("selectedItem");this.option("acceptCustomValue")?this._updateField(t):this.option("searchEnabled")&&!this._searchValue()&&this.option("allowClearing")?this._clearTextValue():this._isValueEqualInputText()||this._renderInputValue().always(function(e){var i=o.ensureDefined(e,t);this._setSelectedItem(i),this._updateField(i),this._clearFilter()}.bind(this))}.bind(this))},_focusOutHandler:function(t){this.callBase(t),this._clearSearchTimer(),this._restoreInputText()},_clearTextValue:function(){this.option("value",null)},_shouldOpenPopup:function(){return this._needPassDataSourceToList()},_isFocused:function(){var t=f.getActiveElement();return this.callBase()&&s(t).closest(this._input()).length>0},_renderValueChangeEvent:function(){this._isEditable()&&this.callBase()},_isEditable:function(){return this.option("acceptCustomValue")||this.option("searchEnabled")},_fieldRenderData:function(){var t=this._list&&this.option("opened")&&s(this._list.option("focusedElement"));return t&&t.length?this._list._getItemData(t):this.option("selectedItem")},_readOnlyPropValue:function(){return!this._isEditable()||this.option("readOnly")},_isSelectedValue:function(t){return this._isValueEquals(t,this.option("value"))},_shouldCloseOnItemClick:function(){return!(this.option("showSelectionControls")&&"single"!==this.option("selectionMode"))},_listItemClickHandler:function(t){var e=this._getCurrentValue();this._focusListElement(s(t.itemElement)),this._saveValueChangeEvent(t.event),this._shouldClearFilter()&&this._clearFilter(),this._completeSelection(this._valueGetter(t.itemData)),this._shouldCloseOnItemClick()&&this.option("opened",!1),this.option("searchEnabled")&&e===this._valueGetter(t.itemData)&&this._updateField(t.itemData)},_shouldClearFilter:function(){return this._wasSearch()},_completeSelection:function(t){this._setValue(t)},_loadItem:function(t,e){var i=this,s=new _;return this.callBase(t,e).done(function(t){s.resolve(t)}.bind(this)).fail(function(){var e=i.option("selectedItem");i.option("acceptCustomValue")&&t===i._valueGetter(e)?s.resolve(e):s.reject()}.bind(this)),s.promise()},_loadInputValue:function(t,e){return this._loadItemDeferred=this._loadItem(t).always(e),this._loadItemDeferred},_isCustomItemSelected:function(){var t=this.option("selectedItem"),e=this._searchValue(),i=this._displayGetter(t);return!i||e!==i.toString()},_valueChangeEventHandler:function(){this.option("acceptCustomValue")&&this._isCustomItemSelected()&&this._customItemAddedHandler()},_initCustomItemCreatingAction:function(){this._customItemCreatingAction=this._createActionByOption("onCustomItemCreating")},_createCustomItem:function(t){var e={text:t},i=this._customItemCreatingAction(e),s=o.ensureDefined(i,e.customItem);return a(i)&&m.log("W0015","onCustomItemCreating","customItem"),s},_customItemAddedHandler:function(){var t=this._searchValue(),e=this._createCustomItem(t);if(void 0===e)throw this._renderValue(),m.Error("E0121");r(e)?p.fromPromise(e).done(this._setCustomItem.bind(this)).fail(this._setCustomItem.bind(this,null)):this._setCustomItem(e)},_setCustomItem:function(t){this._disposed||(t=t||null,this.option("selectedItem",t),this._shouldClearFilter()&&this._filterDataSource(null),this._setValue(this._valueGetter(t)),this._renderDisplayText(this._displayGetter(t)))},_createClearButton:function(){var t=C.addNamespace(V.name,this.NAME),e=this.callBase();return n.on(e,t,(function(){return!1})),e},_wasSearch:function(t){if(!arguments.length)return this._wasSearchValue;this._wasSearchValue=t},_searchHandler:function(t){this._preventFiltering?delete this._preventFiltering:(this._needPassDataSourceToList()&&this._wasSearch(!0),this.callBase(t))},_dataSourceFiltered:function(t){this.callBase(),null!==t&&(this._renderInputSubstitution(),this._renderFocusedElement())},_valueSubstituted:function(){var t=this._input().get(0),e=0===t.selectionStart&&t.selectionEnd===this._searchValue().length,i=t.selectionStart!==t.selectionEnd;return this._wasSearch()&&i&&!e},_shouldSubstitutionBeRendered:function(){return this.option("autocompletionEnabled")&&!this._preventSubstitution&&this.option("searchEnabled")&&!this.option("acceptCustomValue")&&"startswith"===this.option("searchMode")},_renderInputSubstitution:function(){if(this._shouldSubstitutionBeRendered()){var t=this._list&&this._getPlainItems(this._list.option("items"))[0];if(t){var e=this._input(),i=e.val().length;if(0!==i){var s=e.get(0),n=this._displayGetter(t).toString();s.value=n,this._caret({start:i,end:n.length})}}}else delete this._preventSubstitution},_cleanInputSelection:function(){var t=this._input().get(0),e=t.value.length;t.selectionStart=e,t.selectionEnd=e},_dispose:function(){this._renderInputValueAsync=o.noop,delete this._loadItemDeferred,this.callBase()},_optionChanged:function(t){switch(t.name){case"_isAdaptablePopupPosition":case"autocompletionEnabled":break;case"onCustomItemCreating":this._initCustomItemCreatingAction();break;case"tooltipEnabled":this._renderTooltip();break;case"displayCustomValue":case"acceptCustomValue":case"showSelectionControls":case"useInkRipple":this._invalidate();break;case"selectedItem":t.previousValue!==t.value&&this.callBase(t);break;case"allowClearing":break;default:this.callBase(t)}},_clean:function(){delete this._inkRipple,this.callBase()}});g("dxSelectBox",A),i.exports=A,i.exports.default=i.exports}

