function module(e,t,n){"use strict";var i=e("../../core/renderer"),a=e("../../events/core/events_engine"),s=e("./ui.errors"),o=e("../../core/action"),r=e("../../core/utils/extend").extend,c=e("../../core/utils/array").inArray,d=e("../../core/utils/iterator").each,l=e("../../core/utils/common"),u=e("../../core/utils/type"),h=e("../../core/utils/dom"),_=e("../../core/dom_adapter"),f=e("../../core/devices"),p=e("../../core/dom_component"),v=e("./template"),m=e("./ui.template_base"),g=e("./function_template"),b=e("./empty_template"),T=e("./child_default_template"),y=e("./ui.keyboard_processor"),E=e("./selectors"),x=e("../../events/utils"),C=e("../../events/hover"),F=e("../../events/core/emitter.feedback"),S=e("../../events/click"),k=e("../../core/utils/inflector"),A="UIFeedback",O="dx-widget",B="dx-state-active",H="dx-state-disabled",I="dx-state-invisible",R="dx-state-hover",w="dx-state-focused",N=30,K=400,P="Focus",D="template",V=3,U="[data-options*='dxTemplate']",M="dx-template-wrapper",$=new g((function(e){var t=e.model.widget;if(t){var n=i("<div>"),a=e.model.options||{};if("button"===t||"tabs"===t||"dropDownMenu"===t){var o=t;t=k.camelize("dx-"+t),s.log("W0001","dxToolbar - 'widget' item field",o,"16.1","Use: '"+t+"' instead")}return e.parent?e.parent._createComponent(n,t,a):n[t](a),n}return i()})),z=p.inherit({_supportedKeys:function(){return{}},_getDefaultOptions:function(){return r(this.callBase(),{disabled:!1,visible:!0,hint:void 0,activeStateEnabled:!1,onContentReady:null,hoverStateEnabled:!1,focusStateEnabled:!1,tabIndex:0,accessKey:null,onFocusIn:null,onFocusOut:null,integrationOptions:{watchMethod:function(e,t,n){return(n=n||{}).skipImmediate||t(e()),l.noop},templates:{"dx-polymorph-widget":$},createTemplate:function(e){return new v(e)}},_keyboardProcessor:void 0})},_feedbackShowTimeout:30,_feedbackHideTimeout:400,_init:function(){this.callBase(),this._tempTemplates=[],this._defaultTemplates={},this._initTemplates(),this._initContentReadyAction()},_initTemplates:function(){this._extractTemplates(),this._extractAnonymousTemplate()},_clearInnerOptionCache:function(e){this[e+"Cache"]={}},_cacheInnerOptions:function(e,t){var n=e+"Cache";this[n]=r(this[n],t)},_getInnerOptionsCache:function(e){return this[e+"Cache"]},_initInnerOptionCache:function(e){this._clearInnerOptionCache(e),this._cacheInnerOptions(e,this.option(e))},_bindInnerWidgetOptions:function(e,t){this._options[t]=r({},e.option()),e.on("optionChanged",function(e){this._options[t]=r({},e.component.option())}.bind(this))},_extractTemplates:function(){var e=this.$element().contents().filter(U),t={};e.each((function(e,n){var a=h.getElementOptions(n).dxTemplate;if(a){if(!a.name)throw s.Error("E0023");i(n).addClass("dx-template-wrapper").detach(),t[a.name]=t[a.name]||[],t[a.name].push(n)}})),d(t,function(e,t){var n=this._findTemplateByDevice(t);n&&this._saveTemplate(e,n)}.bind(this))},_saveTemplate:function(e,t){var n;this.option("integrationOptions.templates")[e]=this._createTemplate(t)},_findTemplateByDevice:function(e){var t=l.findBestMatches(f.current(),e,(function(e){return h.getElementOptions(e).dxTemplate}))[0];return d(e,(function(e,n){n!==t&&i(n).remove()})),t},_extractAnonymousTemplate:function(){var e=this.option("integrationOptions.templates"),t=this._getAnonymousTemplateName(),n=this.$element().contents().detach(),a,s=n.filter((function(e,t){var n=3===t.nodeType,a=i(t).text().trim().length<1;return!(n&&a)})).length<1;e[t]||s||(e[t]=this._createTemplate(n))},_getAriaTarget:function(){return this._focusTarget()},_getAnonymousTemplateName:function(){return"template"},_getTemplateByOption:function(e){return this._getTemplate(this.option(e))},_getTemplate:function(e){return u.isFunction(e)?new g(function(t){var n=e.apply(this,this._getNormalizedTemplateArgs(t));if(!u.isDefined(n))return new b;var a=!1,s=this._acquireTemplate(n,function(e){return e.nodeType||u.isRenderer(e)&&!i(e).is("script")?new g((function(){return e})):(a=!0,this._createTemplate(e))}.bind(this)),o=s.render(t);return a&&s.dispose&&s.dispose(),o}.bind(this)):this._acquireTemplate(e,this._createTemplateIfNeeded.bind(this))},_acquireTemplate:function(e,t){return null==e?new b:e instanceof T?this._defaultTemplates[e.name]:e instanceof m?e:u.isFunction(e.render)&&!u.isRenderer(e)?this._addOneRenderedCall(e):e.nodeType||u.isRenderer(e)?t(i(e)):"string"==typeof e?this._renderIntegrationTemplate(e)||this._defaultTemplates[e]||t(e):this._acquireTemplate(e.toString(),t)},_addOneRenderedCall:function(e){var t=e.render.bind(e);return r({},e,{render:function(e){var n=t(e);return e&&e.onRendered&&e.onRendered(),n}})},_renderIntegrationTemplate:function(e){var t=this.option("integrationOptions.templates")[e],n;if(t&&!(t instanceof m)&&!this.option("templatesRenderAsynchronously"))return this._addOneRenderedCall(t);return t},_createTemplateIfNeeded:function(e){var t=function(e){return u.isRenderer(e)&&e[0]||e},n=this._tempTemplates.filter((function(n){return e=t(e),n.source===e}))[0];if(n)return n.template;var i=this._createTemplate(e);return this._tempTemplates.push({template:i,source:t(e)}),i},_createTemplate:function(e){return e="string"==typeof e?h.normalizeTemplateElement(e):e,this.option("integrationOptions.createTemplate")(e)},_getNormalizedTemplateArgs:function(e){var t=[];return"model"in e&&t.push(e.model),"index"in e&&t.push(e.index),t.push(e.container),t},_cleanTemplates:function(){this._tempTemplates.forEach((function(e){e.template.dispose&&e.template.dispose()})),this._tempTemplates=[]},_initContentReadyAction:function(){this._contentReadyAction=this._createActionByOption("onContentReady",{excludeValidators:["designMode","disabled","readOnly"]})},_initMarkup:function(){this.$element().addClass("dx-widget"),this._toggleDisabledState(this.option("disabled")),this._toggleVisibility(this.option("visible")),this._renderHint(),this._isFocusable()&&this._renderFocusTarget(),this.callBase()},_render:function(){this.callBase(),this._renderContent(),this._renderFocusState(),this._attachFeedbackEvents(),this._attachHoverEvents()},_renderHint:function(){h.toggleAttr(this.$element(),"title",this.option("hint"))},_renderContent:function(){var e=this;l.deferRender((function(){if(!e._disposed)return e._renderContentImpl()})).done((function(){e._disposed||e._fireContentReadyAction()}))},_renderContentImpl:l.noop,_fireContentReadyAction:l.deferRenderer((function(){this._contentReadyAction()})),_dispose:function(){this._cleanTemplates(),this._contentReadyAction=null,this.callBase()},_resetActiveState:function(){this._toggleActiveState(this._eventBindingTarget(),!1)},_clean:function(){this._cleanFocusState(),this._resetActiveState(),this.callBase(),this.$element().empty()},_toggleVisibility:function(e){this.$element().toggleClass("dx-state-invisible",!e),this.setAria("hidden",!e||void 0)},_renderFocusState:function(){this._attachKeyboardEvents(),this._isFocusable()&&(this._renderFocusTarget(),this._attachFocusEvents(),this._renderAccessKey())},_renderAccessKey:function(){var e=this._focusTarget();e.attr("accesskey",this.option("accessKey"));var t=x.addNamespace(S.name,A);a.off(e,t),this.option("accessKey")&&a.on(e,t,function(e){x.isFakeClickEvent(e)&&(e.stopImmediatePropagation(),this.focus())}.bind(this))},_isFocusable:function(){return this.option("focusStateEnabled")&&!this.option("disabled")},_eventBindingTarget:function(){return this.$element()},_focusTarget:function(){return this._getActiveElement()},_getActiveElement:function(){var e=this._eventBindingTarget();return this._activeStateUnit&&(e=e.find(this._activeStateUnit).not(".dx-state-disabled")),e},_renderFocusTarget:function(){this._focusTarget().attr("tabIndex",this.option("tabIndex"))},_keyboardEventBindingTarget:function(){return this._eventBindingTarget()},_detachFocusEvents:function(){var e=this._focusTarget(),t=this.NAME+"Focus",n=x.addNamespace("focusin",t);n=n+" "+x.addNamespace("focusout",t),_.hasDocumentProperty("onbeforeactivate")&&(n=n+" "+x.addNamespace("beforeactivate",t)),a.off(e,n)},_attachFocusEvents:function(){var e=this.NAME+"Focus",t=x.addNamespace("focusin",e),n=x.addNamespace("focusout",e),s=this._focusTarget();if(a.on(s,t,this._focusInHandler.bind(this)),a.on(s,n,this._focusOutHandler.bind(this)),_.hasDocumentProperty("onbeforeactivate")){var o=x.addNamespace("beforeactivate",e);a.on(this._focusTarget(),o,(function(e){i(e.target).is(E.focusable)||e.preventDefault()}))}},_refreshFocusEvent:function(){this._detachFocusEvents(),this._attachFocusEvents()},_focusInHandler:function(e){var t=this;t._createActionByOption("onFocusIn",{beforeExecute:function(){t._updateFocusState(e,!0)},excludeValidators:["readOnly"]})({event:e})},_focusOutHandler:function(e){var t=this;t._createActionByOption("onFocusOut",{beforeExecute:function(){t._updateFocusState(e,!1)},excludeValidators:["readOnly","disabled"]})({event:e})},_updateFocusState:function(e,t){var n=e.target;-1!==c(n,this._focusTarget())&&this._toggleFocusClass(t,i(n))},_toggleFocusClass:function(e,t){var n;(t&&t.length?t:this._focusTarget()).toggleClass("dx-state-focused",e)},_hasFocusClass:function(e){var t;return i(e||this._focusTarget()).hasClass("dx-state-focused")},_isFocused:function(){return this._hasFocusClass()},_attachKeyboardEvents:function(){var e=this.option("_keyboardProcessor");e?this._keyboardProcessor=e.reinitialize(this._keyboardHandler,this):this.option("focusStateEnabled")&&(this._disposeKeyboardProcessor(),this._keyboardProcessor=new y({element:this._keyboardEventBindingTarget(),handler:this._keyboardHandler,focusTarget:this._focusTarget(),context:this}))},_keyboardHandler:function(e){var t=e.originalEvent,n=e.keyName,i=e.which,a=this._supportedKeys(t),s=a[n]||a[i],o;return void 0===s||(s.bind(this)(t)||!1)},_refreshFocusState:function(){this._cleanFocusState(),this._renderFocusState()},_cleanFocusState:function(){var e=this._focusTarget();this._detachFocusEvents(),this._toggleFocusClass(!1),e.removeAttr("tabIndex"),this._disposeKeyboardProcessor()},_disposeKeyboardProcessor:function(){this._keyboardProcessor&&(this._keyboardProcessor.dispose(),delete this._keyboardProcessor)},_attachHoverEvents:function(){var e=this,t=e._activeStateUnit,n=x.addNamespace(C.start,A),s=x.addNamespace(C.end,A);if(a.off(e._eventBindingTarget(),n,t),a.off(e._eventBindingTarget(),s,t),e.option("hoverStateEnabled")){var r=new o((function(t){e._hoverStartHandler(t.event),e._refreshHoveredElement(i(t.element))}),{excludeValidators:["readOnly"]}),c=e._eventBindingTarget();a.on(c,n,t,(function(e){r.execute({element:i(e.target),event:e})})),a.on(c,s,t,(function(t){e._hoverEndHandler(t),e._forgetHoveredElement()}))}else e._toggleHoverClass(!1)},_hoverStartHandler:l.noop,_hoverEndHandler:l.noop,_attachFeedbackEvents:function(){var e,t,n=this,s=n._activeStateUnit,r=x.addNamespace(F.active,A),c=x.addNamespace(F.inactive,A);if(a.off(n._eventBindingTarget(),r,s),a.off(n._eventBindingTarget(),c,s),n.option("activeStateEnabled")){var d=function(e){var t=i(e.element),a=e.value,s=e.event;n._toggleActiveState(t,a,s)};a.on(n._eventBindingTarget(),r,s,{timeout:n._feedbackShowTimeout},(function(t){(e=e||new o(d)).execute({element:i(t.currentTarget),value:!0,event:t})})),a.on(n._eventBindingTarget(),c,s,{timeout:n._feedbackHideTimeout},(function(e){(t=t||new o(d,{excludeValidators:["disabled","readOnly"]})).execute({element:i(e.currentTarget),value:!1,event:e})}))}},_toggleActiveState:function(e,t){this._toggleHoverClass(!t),e.toggleClass("dx-state-active",t)},_refreshHoveredElement:function(e){var t=this._activeStateUnit||this._eventBindingTarget();this._forgetHoveredElement(),this._hoveredElement=e.closest(t),this._toggleHoverClass(!0)},_forgetHoveredElement:function(){this._toggleHoverClass(!1),delete this._hoveredElement},_toggleHoverClass:function(e){this._hoveredElement&&this._hoveredElement.toggleClass("dx-state-hover",e&&this.option("hoverStateEnabled"))},_toggleDisabledState:function(e){this.$element().toggleClass("dx-state-disabled",Boolean(e)),this._toggleHoverClass(!e),this.setAria("disabled",e||void 0)},_setWidgetOption:function(e,t){if(this[e])if(u.isPlainObject(t[0]))d(t[0],function(t,n){this._setWidgetOption(e,[t,n])}.bind(this));else{var n=t[0],i=t[1];1===t.length&&(i=this.option(n));var a=this[e+"OptionMap"];this[e].option(a?a(n):n,i)}},_optionChanged:function(e){switch(e.name){case"disabled":this._toggleDisabledState(e.value),this._refreshFocusState();break;case"hint":this._renderHint();break;case"activeStateEnabled":this._attachFeedbackEvents();break;case"hoverStateEnabled":this._attachHoverEvents();break;case"tabIndex":case"_keyboardProcessor":case"focusStateEnabled":this._refreshFocusState();break;case"onFocusIn":case"onFocusOut":break;case"accessKey":this._renderAccessKey();break;case"visible":var t=e.value;this._toggleVisibility(t),this._isVisibilityChangeSupported()&&this._checkVisibilityChanged(e.value?"shown":"hiding");break;case"onContentReady":this._initContentReadyAction();break;default:this.callBase(e)}},_isVisible:function(){return this.callBase()&&this.option("visible")},beginUpdate:function(){this._ready(!1),this.callBase()},endUpdate:function(){this.callBase(),this._initialized&&this._ready(!0)},_ready:function(e){if(0===arguments.length)return this._isReady;this._isReady=e},setAria:function(){var e=function(e){var t="role"===e.name||"id"===e.name?e.name:"aria-"+e.name,n=e.value;n=null==n?void 0:n.toString(),h.toggleAttr(e.target,t,n)};if(u.isPlainObject(arguments[0])){var t=arguments[1]||this._getAriaTarget();d(arguments[0],(function(n,i){e({name:n,value:i,target:t})}))}else e({name:arguments[0],value:arguments[1],target:arguments[2]||this._getAriaTarget()})},isReady:function(){return this._ready()},repaint:function(){this._refresh()},focus:function(){a.trigger(this._focusTarget(),"focus")},registerKeyHandler:function(e,t){var n=this._supportedKeys(),i={};i[e]=t,this._supportedKeys=function(){return r(n,i)}}});n.exports=z}

