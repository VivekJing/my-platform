function module(e,t,s){"use strict";var i=e("../../core/class"),n=e("./selection.strategy.deferred"),o=e("./selection.strategy.standard"),c=e("../../core/utils/extend").extend,l=e("../../core/utils/common").noop,d=e("../../core/utils/type").isDefined,r=e("../../core/utils/deferred").Deferred;s.exports=i.inherit({ctor:function(e){this.options=c(this._getDefaultOptions(),e,{selectedItemKeys:e.selectedKeys||[]}),this._selectionStrategy=this.options.deferred?new n(this.options):new o(this.options),this._focusedItemIndex=-1,this.options.equalByReference||this._selectionStrategy.updateSelectedItemKeyHash(this.options.selectedItemKeys)},_getDefaultOptions:function(){return{deferred:!1,equalByReference:!1,mode:"multiple",selectedItems:[],selectionFilter:[],maxFilterLengthInRequest:0,onSelectionChanged:l,key:l,keyOf:function(e){return e},load:function(){return(new r).resolve([])},totalCount:function(){return-1},isSelectableItem:function(){return!0},isItemSelected:function(){return!1},getItemData:function(e){return e},dataFields:l,filter:l}},validate:function(){this._selectionStrategy.validate()},getSelectedItemKeys:function(){return this._selectionStrategy.getSelectedItemKeys()},getSelectedItems:function(){return this._selectionStrategy.getSelectedItems()},selectionFilter:function(e){if(void 0===e)return this.options.selectionFilter;var t=this.options.selectionFilter!==e&&JSON.stringify(this.options.selectionFilter)!==JSON.stringify(e);this.options.selectionFilter=e,t&&this.onSelectionChanged()},setSelection:function(e){return this.selectedItemKeys(e)},select:function(e){return this.selectedItemKeys(e,!0)},deselect:function(e){return this.selectedItemKeys(e,!0,!0)},selectedItemKeys:function(e,t,s,i){var n=this;return e=e||[],e=Array.isArray(e)?e:[e],this.validate(),this._selectionStrategy.selectedItemKeys(e,t,s,i)},clearSelection:function(){return this.selectedItemKeys([])},_addSelectedItem:function(e,t){this._selectionStrategy.addSelectedItem(t,e)},_removeSelectedItem:function(e){this._selectionStrategy.removeSelectedItem(e)},_setSelectedItems:function(e,t){this._selectionStrategy.setSelectedItems(e,t)},onSelectionChanged:function(){this._selectionStrategy.onSelectionChanged()},changeItemSelection:function(e,t){var s,i=this.options.plainItems(),n=i[e];if(!this.isSelectable()||!this.isDataItem(n))return!1;var o=this.options.getItemData(n),c=this.options.keyOf(o);if((t=t||{}).shift&&"multiple"===this.options.mode&&this._focusedItemIndex>=0)s=this.changeItemSelectionWhenShiftKeyPressed(e,i);else if(t.control){this._resetItemSelectionWhenShiftKeyPressed();var l=this._selectionStrategy.isItemDataSelected(o);"single"===this.options.mode&&this.clearSelectedItems(),l?this._removeSelectedItem(c):this._addSelectedItem(o,c),s=!0}else{this._resetItemSelectionWhenShiftKeyPressed();var d=this._selectionStrategy.equalKeys(this.options.selectedItemKeys[0],c);1===this.options.selectedItemKeys.length&&d||(this._setSelectedItems([c],[o]),s=!0)}return s?(this._focusedItemIndex=e,this.onSelectionChanged(),!0):void 0},isDataItem:function(e){return this.options.isSelectableItem(e)},isSelectable:function(){return"single"===this.options.mode||"multiple"===this.options.mode},isItemDataSelected:function(e){return this._selectionStrategy.isItemDataSelected(e)},isItemSelected:function(e){return this._selectionStrategy.isItemKeySelected(e)},_resetItemSelectionWhenShiftKeyPressed:function(){delete this._shiftFocusedItemIndex},_resetFocusedItemIndex:function(){this._focusedItemIndex=-1},changeItemSelectionWhenShiftKeyPressed:function(e,t){var s,i,n=!1,o=this.options.keyOf,c=t[this._focusedItemIndex],l=this.options.getItemData(c),r=o(l),h=c&&this.isItemDataSelected(l),a,I;if(d(this._shiftFocusedItemIndex)||(this._shiftFocusedItemIndex=this._focusedItemIndex),this._shiftFocusedItemIndex!==this._focusedItemIndex)for(s=this._focusedItemIndex<this._shiftFocusedItemIndex?1:-1,i=this._focusedItemIndex;i!==this._shiftFocusedItemIndex;i+=s)this.isDataItem(t[i])&&(I=o(this.options.getItemData(t[i])),this._removeSelectedItem(I),n=!0);if(e!==this._shiftFocusedItemIndex)for(s=e<this._shiftFocusedItemIndex?1:-1,i=e;i!==this._shiftFocusedItemIndex;i+=s)this.isDataItem(t[i])&&(I=o(a=this.options.getItemData(t[i])),this._addSelectedItem(a,I),n=!0);return this.isDataItem(c)&&!h&&(this._addSelectedItem(l,r),n=!0),n},clearSelectedItems:function(){this._setSelectedItems([],[])},selectAll:function(e){return this._resetFocusedItemIndex(),e?this._onePageSelectAll(!1):this.selectedItemKeys([],!0,!1,!0)},deselectAll:function(e){return this._resetFocusedItemIndex(),e?this._onePageSelectAll(!0):this.selectedItemKeys([],!0,!0,!0)},_onePageSelectAll:function(e){for(var t=this.options.plainItems(),s=0;s<t.length;s++){var i=t[s];if(this.isDataItem(i)){var n=this.options.getItemData(i),o=this.options.keyOf(n),c=this.isItemSelected(o);c||e||this._addSelectedItem(n,o),c&&e&&this._removeSelectedItem(o)}}return this.onSelectionChanged(),(new r).resolve()},getSelectAllState:function(e){return this._selectionStrategy.getSelectAllState(e)}})}

