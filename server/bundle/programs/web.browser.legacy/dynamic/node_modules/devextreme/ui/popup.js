function module(t,e,o){"use strict";var i=t("../core/renderer"),n=t("../core/utils/window").getWindow(),s=t("../animation/translator"),r=t("../core/utils/inflector").camelize,a=t("../core/utils/common").noop,l=t("../core/utils/dom").getPublicElement,c=t("../core/utils/iterator").each,p=t("../core/utils/type").isDefined,h=t("../core/utils/array").inArray,u=t("../core/utils/extend").extend,d=t("../core/utils/browser"),f=t("../core/utils/version").compare,m=t("../localization/message"),g=t("../core/devices"),_=t("../core/component_registrator"),b=t("./button"),v=t("./themes"),C=t("./overlay"),y=t("./widget/empty_template"),T=t("../core/utils/dom"),x=t("../core/utils/size"),B=t("../core/utils/window");t("./toolbar/ui.toolbar.base");var w="dx-popup",$="dx-popup-wrapper",A="dx-popup-fullscreen",H="dx-popup-fullscreen-width",R="dx-popup-normal",O="dx-popup-content",I="dx-popup-draggable",S="dx-popup-title",k="dx-closebutton",E="dx-popup-bottom",D="dx-template-wrapper",V="dx-popup-flex-height",z="dx-popup-inherit-height",F=["cancel","clear","done"],P="default",W="normal",M="text",G="contained",q=d.msie&&11===parseInt(d.version),N=d.safari&&f(d.version,[11])<0,j={static:"",inherit:"dx-popup-inherit-height",flex:"dx-popup-flex-height"},J=function(t){var e=g.current(),o=e.platform,i="bottom",n="before";if("ios"===o)switch(t){case"cancel":i="top";break;case"clear":i="top",n="after";break;case"done":n="after"}else if("win"===o)n="after";else if("android"===o&&e.version&&parseInt(e.version[0])>4)switch(t){case"cancel":n="after";break;case"done":n="after"}else"android"===o&&(n="center");return{toolbar:i,location:n}},K=C.inherit({_getDefaultOptions:function(){return u(this.callBase(),{fullScreen:!1,title:"",showTitle:!0,titleTemplate:"title",onTitleRendered:null,dragEnabled:!1,toolbarItems:[],showCloseButton:!1,bottomTemplate:"bottom",useDefaultToolbarButtons:!1,useFlatToolbarButtons:!1,autoResizeEnabled:!0})},_defaultOptionsRules:function(){var t=v.current();return this.callBase().concat([{device:function(e){return e.phone&&v.isWin8(t)},options:{position:{my:"top center",at:"top center",offset:"0 0"}}},{device:{platform:"ios"},options:{animation:this._iosAnimation}},{device:{platform:"android"},options:{animation:this._androidAnimation}},{device:{platform:"generic"},options:{showCloseButton:!0}},{device:function(t){return"generic"===g.real().platform&&"generic"===t.platform},options:{dragEnabled:!0}},{device:function(){return"desktop"===g.real().deviceType&&!g.isSimulator()},options:{focusStateEnabled:!0}},{device:function(){return v.isMaterial(t)},options:{useDefaultToolbarButtons:!0,useFlatToolbarButtons:!0}}])},_iosAnimation:{show:{type:"slide",duration:400,from:{position:{my:"top",at:"bottom"}},to:{position:{my:"center",at:"center"}}},hide:{type:"slide",duration:400,from:{opacity:1,position:{my:"center",at:"center"}},to:{opacity:1,position:{my:"top",at:"bottom"}}}},_androidAnimation:function(){var t={show:{type:"slide",duration:300,from:{top:"30%",opacity:0},to:{top:0,opacity:1}},hide:{type:"slide",duration:300,from:{top:0,opacity:1},to:{top:"30%",opacity:0}}},e={show:{type:"fade",duration:400,from:0,to:1},hide:{type:"fade",duration:400,from:1,to:0}};return this.option("fullScreen")?t:e},_init:function(){this.callBase(),this.$element().addClass("dx-popup"),this._wrapper().addClass("dx-popup-wrapper"),this._$popupContent=this._$content.wrapInner(i("<div>").addClass("dx-popup-content")).children().eq(0)},_render:function(){var t=this.option("fullScreen");this._toggleFullScreenClass(t),this.callBase()},_toggleFullScreenClass:function(t){this._$content.toggleClass("dx-popup-fullscreen",t).toggleClass("dx-popup-normal",!t)},_initTemplates:function(){this.callBase(),this._defaultTemplates.title=new y(this),this._defaultTemplates.bottom=new y(this)},_renderContentImpl:function(){this._renderTitle(),this.callBase(),this._renderBottom()},_renderTitle:function(){var t=this._getToolbarItems("top"),e=this.option("title"),o=this.option("showTitle");if(o&&e&&t.unshift({location:g.current().ios?"center":"before",text:e}),o||t.length>0){this._$title&&this._$title.remove();var n=i("<div>").addClass("dx-popup-title").insertBefore(this.$content());this._$title=this._renderTemplateByType("titleTemplate",t,n).addClass("dx-popup-title"),this._renderDrag(),this._executeTitleRenderAction(this._$title)}else this._$title&&this._$title.detach()},_renderTemplateByType:function(t,e,o,n){var s=this._getTemplateByOption(t),r;if(s instanceof y){var a=u(n,{items:e,rtlEnabled:this.option("rtlEnabled"),useDefaultButtons:this.option("useDefaultToolbarButtons"),useFlatButtons:this.option("useFlatToolbarButtons")});this._getTemplate("dx-polymorph-widget").render({container:o,model:{widget:"dxToolbarBase",options:a}});var c=o.children("div");return o.replaceWith(c),c}var p=i(s.render({container:l(o)}));return p.hasClass("dx-template-wrapper")&&(o.replaceWith(p),o=p),o},_executeTitleRenderAction:function(t){this._getTitleRenderAction()({titleElement:l(t)})},_getTitleRenderAction:function(){return this._titleRenderAction||this._createTitleRenderAction()},_createTitleRenderAction:function(){return this._titleRenderAction=this._createActionByOption("onTitleRendered",{element:this.element(),excludeValidators:["designMode","disabled","readOnly"]})},_getCloseButton:function(){return{toolbar:"top",location:"after",template:this._getCloseButtonRenderer()}},_getCloseButtonRenderer:function(){return function(t,e,o){var n=i("<div>").addClass("dx-closebutton");this._createComponent(n,b,{icon:"close",onClick:this._createToolbarItemAction(void 0),integrationOptions:{}}),i(o).append(n)}.bind(this)},_getToolbarItems:function(t){var e=this.option("toolbarItems"),o=[];this._toolbarItemClasses=[];var i=g.current().platform,n=0;return c(e,function(e,s){var r=p(s.shortcut),a=r?J(s.shortcut):s;if(r&&"ios"===i&&n<2&&(a.toolbar="top",n++),a.toolbar=s.toolbar||a.toolbar||"top",a&&a.toolbar===t){r&&u(a,{location:s.location},this._getToolbarItemByAlias(s));var l="win"===i||"generic"===i;"done"===s.shortcut&&l||"cancel"===s.shortcut&&!l?o.unshift(a):o.push(a)}}.bind(this)),"top"===t&&this.option("showCloseButton")&&this.option("showTitle")&&o.push(this._getCloseButton()),o},_getToolbarItemByAlias:function(t){var e=this,o=t.shortcut;if(h(o,F)<0)return!1;var n=u({text:m.format(r(o,!0)),onClick:this._createToolbarItemAction(t.onClick),integrationOptions:{},type:e.option("useDefaultToolbarButtons")?"default":"normal",stylingMode:e.option("useFlatToolbarButtons")?"text":"contained"},t.options||{}),s="dx-popup-"+o;return this._toolbarItemClasses.push(s),{template:function(t,o,r){var a=i("<div>").addClass(s).appendTo(r);e._createComponent(a,b,n)}}},_createToolbarItemAction:function(t){return this._createAction(t,{afterExecute:function(t){t.component.hide()}})},_renderBottom:function(){var t=this._getToolbarItems("bottom");if(t.length){this._$bottom&&this._$bottom.remove();var e=i("<div>").addClass("dx-popup-bottom").insertAfter(this.$content());this._$bottom=this._renderTemplateByType("bottomTemplate",t,e,{compactMode:!0}).addClass("dx-popup-bottom"),this._toggleClasses()}else this._$bottom&&this._$bottom.detach()},_toggleClasses:function(){var t;c(F,function(t,e){var o="dx-popup-"+e;h(o,this._toolbarItemClasses)>=0?(this._wrapper().addClass(o+"-visible"),this._$bottom.addClass(o)):(this._wrapper().removeClass(o+"-visible"),this._$bottom.removeClass(o))}.bind(this))},_getDragTarget:function(){return this.topToolbar()},_renderGeometryImpl:function(){this._resetContentHeight(),this.callBase.apply(this,arguments),this._setContentHeight()},_resetContentHeight:function(){this._$popupContent.css({height:"auto"})},_renderDrag:function(){this.callBase(),this._$content.toggleClass("dx-popup-draggable",this.option("dragEnabled"))},_renderResize:function(){this.callBase(),this._resizable.option("onResize",function(){this._setContentHeight(),this._actions.onResize(arguments)}.bind(this))},_setContentHeight:function(){(this.option("forceApplyBindings")||a)();var t=this.overlayContent().get(0),e=this._chooseHeightStrategy(t);this.$content().css(this._getHeightCssStyles(e,t)),this._setHeightClasses(this.overlayContent(),e)},_heightStrategyChangeOffset:function(t,e){return t===j.flex?-e:0},_chooseHeightStrategy:function(t){var e="auto"===t.style.width||""===t.style.width,o=j.static;return this._isAutoHeight()&&this.option("autoResizeEnabled")&&(e||N?q||(o=j.inherit):o=j.flex),o},_getHeightCssStyles:function(t,e){var o={},n=this._getOptionValue("maxHeight",e),s=this._getOptionValue("minHeight",e),r=this._splitPopupHeight(),a=r.header+r.footer+r.contentVerticalOffsets+r.popupVerticalOffsets+this._heightStrategyChangeOffset(t,r.popupVerticalPaddings);if(t===j.static){if(!this._isAutoHeight()||n||s){var l=e.getBoundingClientRect().height-a;o={height:Math.max(0,l),minHeight:"auto",maxHeight:"auto"}}}else{var c=i(this._getContainer()).get(0),p=x.addOffsetToMaxHeight(n,-a,c),h;o={height:"auto",minHeight:x.addOffsetToMinHeight(s,-a,c),maxHeight:p}}return o},_setHeightClasses:function(t,e){var o="";for(var i in j)j[i]!==e&&(o+=" "+j[i]);t.removeClass(o).addClass(e)},_isAutoHeight:function(){return"auto"===this.overlayContent().get(0).style.height},_splitPopupHeight:function(){var t=this.topToolbar(),e=this.bottomToolbar();return{header:x.getVisibleHeight(t&&t.get(0)),footer:x.getVisibleHeight(e&&e.get(0)),contentVerticalOffsets:x.getVerticalOffsets(this.overlayContent().get(0),!0),popupVerticalOffsets:x.getVerticalOffsets(this.$content().get(0),!0),popupVerticalPaddings:x.getVerticalOffsets(this.$content().get(0),!1)}},_renderDimensions:function(){this.option("fullScreen")?this._$content.css({width:"100%",height:"100%"}):this.callBase.apply(this,arguments),B.hasWindow()&&this._renderFullscreenWidthClass()},_renderFullscreenWidthClass:function(){this.overlayContent().toggleClass("dx-popup-fullscreen-width",this.overlayContent().outerWidth()===i(n).width())},_renderShadingDimensions:function(){this.option("fullScreen")?this._wrapper().css({width:"100%",height:"100%"}):this.callBase.apply(this,arguments)},refreshPosition:function(){this._renderPosition()},_renderPosition:function(){if(!this.option("fullScreen"))return(this.option("forceApplyBindings")||a)(),this.callBase.apply(this,arguments);s.move(this._$content,{top:0,left:0})},_optionChanged:function(t){switch(t.name){case"showTitle":case"title":case"titleTemplate":this._renderTitle(),this._renderGeometry();break;case"bottomTemplate":this._renderBottom(),this._renderGeometry();break;case"onTitleRendered":this._createTitleRenderAction(t.value);break;case"toolbarItems":case"useDefaultToolbarButtons":case"useFlatToolbarButtons":var e=-1!==t.fullName.search(".options");this._renderTitle(),this._renderBottom(),e||this._renderGeometry();break;case"dragEnabled":this._renderDrag();break;case"autoResizeEnabled":this._renderGeometry(),T.triggerResizeEvent(this._$content);break;case"fullScreen":this._toggleFullScreenClass(t.value),this._renderGeometry(),T.triggerResizeEvent(this._$content);break;case"showCloseButton":this._renderTitle();break;default:this.callBase(t)}},bottomToolbar:function(){return this._$bottom},topToolbar:function(){return this._$title},$content:function(){return this._$popupContent},content:function(){return l(this._$popupContent)},overlayContent:function(){return this._$content}});_("dxPopup",K),o.exports=K,o.exports.default=o.exports}

