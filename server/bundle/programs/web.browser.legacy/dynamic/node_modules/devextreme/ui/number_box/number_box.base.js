function module(t,e,n){"use strict";var i=t("../../core/renderer"),s=t("../../core/dom_adapter"),a=t("../../events/core/events_engine"),o=t("../../core/utils/common"),r=t("../../core/utils/math"),u=t("../../core/utils/extend").extend,l=t("../../core/utils/array").inArray,p=t("../../core/devices"),h=t("../../core/utils/browser"),d=t("../text_box/ui.text_editor"),c=t("../../events/utils"),_=t("../../events/pointer"),m=t("./number_box.spin"),v=t("../../localization/message"),f=Math,g="dx-numberbox",b="dx-numberbox-spin",V="dx-numberbox-spin-container",x="dx-numberbox-spin-touch-friendly",C=["tab","del","backspace","leftArrow","rightArrow","home","end","enter"],B=d.inherit({_supportedKeys:function(){return u(this.callBase(),{upArrow:function(t){t.preventDefault(),t.stopPropagation(),this._spinUpChangeHandler(t)},downArrow:function(t){t.preventDefault(),t.stopPropagation(),this._spinDownChangeHandler(t)},enter:function(){}})},_getDefaultOptions:function(){return u(this.callBase(),{value:0,min:void 0,max:void 0,step:1,showSpinButtons:!1,useLargeSpinButtons:!0,mode:"text",invalidValueMessage:v.format("dxNumberBox-invalidValueMessage")})},_isSupportInputMode:function(){var t=parseFloat(h.version);return h.chrome&&t>=66||h.safari&&t>=12||h.msie&&t>=75},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(){return p.real().generic&&!p.isSimulator()},options:{useLargeSpinButtons:!1}},{device:function(){return"generic"!==p.real().platform&&!this._isSupportInputMode()}.bind(this),options:{mode:"number"}}])},_initMarkup:function(){this._renderSubmitElement(),this.$element().addClass(g),this.callBase()},_applyInputAttributes:function(t,e){t.attr("inputmode","decimal"),this.callBase(t,e)},_renderContentImpl:function(){this.option("isValid")&&this._validateValue(this.option("value")),this.setAria("role","spinbutton")},_renderSubmitElement:function(){this._$submitElement=i("<input>").attr("type","hidden").appendTo(this.$element()),this._setSubmitValue(this.option("value"))},_setSubmitValue:function(t){this._$submitElement.val(o.applyServerDecimalSeparator(t))},_getSubmitElement:function(){return this._$submitElement},_keyPressHandler:function(t){this.callBase(t);var e=c.getChar(t),n,i;if(!/[\d.,eE\-+]|Subtract/.test(e)){var s=c.normalizeKeyName(t);if(t.metaKey||t.ctrlKey||s&&l(s,C)>=0)return;return t.preventDefault(),!1}this._keyPressed=!0},_onMouseWheel:function(t){t.delta>0?this._spinValueChange(1,t):this._spinValueChange(-1,t)},_renderValue:function(){var t=this._input().val();t.length&&Number(t)===this.option("value")||(this._forceValueRender(),this._toggleEmptinessEventHandler());var e=this.option("value");this._renderInputAddons(),this.setAria("valuenow",e),this.option("text",this._input().val())},_toggleDisabledState:function(t){this._$spinUp&&m.getInstance(this._$spinUp).option("disabled",t),this._$spinDown&&m.getInstance(this._$spinDown).option("disabled",t),this.callBase.apply(this,arguments)},_forceValueRender:function(){var t=this.option("value"),e=Number(t),n=isNaN(e)?"":this._applyValueFormat(t);this._renderDisplayText(n)},_applyValueFormat:function(t){return this.option("valueFormat")(t)},_renderProps:function(){this.callBase(),this._input().prop({min:this.option("min"),max:this.option("max"),step:this.option("step")}),this.setAria({valuemin:o.ensureDefined(this.option("min"),null),valuemax:o.ensureDefined(this.option("max"),null)})},_renderInputAddons:function(){this.callBase(),this._renderSpinButtons()},_renderSpinButtons:function(){var t=this.option("showSpinButtons");if(this.$element().toggleClass(b,t),this._toggleTouchFriendlyClass(),!t)return this._$spinContainer&&this._$spinContainer.remove(),void(this._$spinContainer=null);this._$spinContainer||(this._$spinContainer=this._createSpinButtons()),this._$spinContainer.prependTo(this._buttonsContainer())},_toggleTouchFriendlyClass:function(){this.$element().toggleClass(x,this.option("showSpinButtons")&&this.option("useLargeSpinButtons"))},_createSpinButtons:function(){var t=c.addNamespace(_.down,this.NAME),e=this._createAction(this._spinButtonsPointerDownHandler.bind(this)),n=i("<div>").addClass(V);return a.off(n,t),a.on(n,t,(function(t){e({event:t})})),this._$spinUp=i("<div>").appendTo(n),this._createComponent(this._$spinUp,m,{direction:"up",onChange:this._spinUpChangeHandler.bind(this)}),this._$spinDown=i("<div>").appendTo(n),this._createComponent(this._$spinDown,m,{direction:"down",onChange:this._spinDownChangeHandler.bind(this)}),n},_spinButtonsPointerDownHandler:function(){var t=this._input();this.option("useLargeSpinButtons")||s.getActiveElement()===t[0]||a.trigger(t,"focus")},_spinUpChangeHandler:function(t){this.option("readOnly")||this._spinValueChange(1,t.event||t)},_spinDownChangeHandler:function(t){this.option("readOnly")||this._spinValueChange(-1,t.event||t)},_spinValueChange:function(t,e){var n=parseFloat(this.option("step"));if(0!==n){var i=parseFloat(this._normalizeInputValue())||0;i=this._correctRounding(i,n*t);var s=this.option("min"),a=this.option("max");void 0!==s&&(i=Math.max(s,i)),void 0!==a&&(i=Math.min(a,i)),this._saveValueChangeEvent(e),this.option("value",i)}},_correctRounding:function(t,e){var n=/[,.](.*)/,i=n.test(t),s=n.test(e);if(i||s){var a=i?n.exec(t)[0].length:0,o=s?n.exec(e)[0].length:0,r=f.max(a,o);return t=this._round(t+e,r)}return t+e},_round:function(t,e){e=e||0;var n=Math.pow(10,e);return t*=n,t=Math.round(t)/n},_renderValueChangeEvent:function(){this.callBase(),a.on(this._input(),"focusout",this._forceRefreshInputValue.bind(this))},_forceRefreshInputValue:function(){if("number"!==this.option("mode")){var t=this._input(),e=this._applyValueFormat(this.option("value"));t.val(null),t.val(e)}},_valueChangeEventHandler:function(t){var e=this._input(),n=this._normalizeText(),i=this._parseValue(n),s="."!==n&&"-"!==n;!this._isValueValid()||this._validateValue(i)?(s&&this.callBase(t,isNaN(i)?null:i),this._applyValueBoundaries(n,i),this.validationRequest.fire({value:i,editor:this})):e.val(this._applyValueFormat(i))},_applyValueBoundaries:function(t,e){var n=this._isValueIncomplete(t),i=this._isValueInRange(t);n||i||null===e||Number(t)!==e&&this._input().val(this._applyValueFormat(e))},_replaceCommaWithPoint:function(t){return t.replace(",",".")},_inputIsInvalid:function(){var t="number"===this.option("mode"),e=this._input().get(0).validity;return t&&e&&e.badInput},_renderDisplayText:function(t){this._inputIsInvalid()||this.callBase(t)},_isValueIncomplete:function(t){var e;return/(^-$)|(^-?\d*\.$)|(\d+e-?$)/i.test(t)},_isValueInRange:function(t){return r.inRange(t,this.option("min"),this.option("max"))},_isNumber:function(t){return null!==this._parseValue(t)},_validateValue:function(t){var e=this._normalizeText(),n=this._isValueValid(),i=!0,s=this._isNumber(e);return isNaN(Number(t))&&(i=!1),!t&&n?i=!0:s||n||(i=!1),this.option({isValid:i,validationError:i?null:{editorSpecific:!0,message:this.option("invalidValueMessage")}}),i},_normalizeInputValue:function(){return this._parseValue(this._normalizeText())},_normalizeText:function(){var t=this._input().val().trim();return this._replaceCommaWithPoint(t)},_parseValue:function(t){var e=parseFloat(t);return isNaN(e)?null:r.fitIntoRange(e,this.option("min"),this.option("max"))},_clearValue:function(){this._inputIsInvalid()&&(this._input().val(""),this._validateValue()),this.callBase()},reset:function(){null===this.option("value")?(this.option("text",""),this._renderValue()):this.option("value",null)},_clean:function(){delete this._$spinContainer,delete this._$spinUp,delete this._$spinDown,this.callBase()},_optionChanged:function(t){switch(t.name){case"value":this._validateValue(t.value),this._setSubmitValue(t.value),this.callBase(t),this._resumeValueChangeAction();break;case"step":this._renderProps();break;case"min":case"max":this._renderProps(),this.option("value",this._parseValue(this.option("value")));break;case"showSpinButtons":this._renderInputAddons();break;case"useLargeSpinButtons":this._toggleTouchFriendlyClass();break;case"invalidValueMessage":break;default:this.callBase(t)}}});n.exports=B}

