function module(e,t,i){"use strict";var a=e("../../core/renderer"),n=e("../../core/element_data"),s=e("../../core/utils/callbacks"),o=e("../../core/utils/common"),l=e("../../core/utils/window"),d=e("../../core/guid"),h=e("../../core/utils/position").getDefaultAlignment,r=e("../../core/utils/extend").extend,u=e("../widget/ui.widget"),c=e("../validation/validation_mixin"),g=e("../overlay"),v="dx-state-readonly",_="dx-invalid",p="dx-invalid-message",m="dx-invalid-message-content",f="dx-invalid-message-auto",M="dx-invalid-message-always",C="dx-validation-target",V=100,y=u.inherit({ctor:function(){this.showValidationMessageTimeout=null,this.callBase.apply(this,arguments)},_init:function(){this.callBase(),this.validationRequest=s(),this._initInnerOptionCache("validationTooltipOptions");var e=this.$element();e&&n.data(e[0],C,this)},_getDefaultOptions:function(){return r(this.callBase(),{value:null,name:"",onValueChanged:null,readOnly:!1,isValid:!0,validationError:null,validationMessageMode:"auto",validationBoundary:void 0,validationMessageOffset:{h:0,v:0},validationTooltipOptions:{}})},_attachKeyboardEvents:function(){this.option("readOnly")||(this.callBase(),this._keyboardProcessor&&this._attachChildKeyboardEvents())},_attachChildKeyboardEvents:o.noop,_setOptionsByReference:function(){this.callBase(),r(this._optionsByReference,{validationError:!0})},_createValueChangeAction:function(){this._valueChangeAction=this._createActionByOption("onValueChanged",{excludeValidators:["disabled","readOnly"]})},_suppressValueChangeAction:function(){this._valueChangeActionSuppressed=!0},_resumeValueChangeAction:function(){this._valueChangeActionSuppressed=!1},_initMarkup:function(){this._toggleReadOnlyState(),this._setSubmitElementName(this.option("name")),this.callBase(),this._renderValidationState()},_raiseValueChangeAction:function(e,t){this._valueChangeAction||this._createValueChangeAction(),this._valueChangeAction(this._valueChangeArgs(e,t))},_valueChangeArgs:function(e,t){return{value:e,previousValue:t,event:this._valueChangeEventInstance}},_saveValueChangeEvent:function(e){this._valueChangeEventInstance=e},_focusInHandler:function(e){var t=this,i="auto"===this.option("validationMessageMode");return this._canValueBeChangedByClick()&&i&&(this._$validationMessage&&this._$validationMessage.removeClass(f),clearTimeout(this.showValidationMessageTimeout),this.showValidationMessageTimeout=setTimeout((function(){return t._$validationMessage&&t._$validationMessage.addClass(f)}),150)),this.callBase(e)},_canValueBeChangedByClick:function(){return!1},_renderValidationState:function(){var e=this.option("isValid"),t=this.option("validationError"),i=this.option("validationMessageMode"),n=this.$element();if(n.toggleClass("dx-invalid",!e),this.setAria("invalid",!e||void 0),l.hasWindow()&&(this._$validationMessage&&(this._$validationMessage.remove(),this.setAria("describedby",null),this._$validationMessage=null),!e&&t&&t.message)){this._$validationMessage=a("<div>").addClass(p).html(t.message).appendTo(n);var s=this._getValidationMessageTarget();this._validationMessage=this._createComponent(this._$validationMessage,g,r({integrationOptions:{},templatesRenderAsynchronously:!1,target:s,shading:!1,width:"auto",height:"auto",container:n,position:this._getValidationMessagePosition("below"),closeOnOutsideClick:!1,closeOnTargetScroll:!1,animation:null,visible:!0,propagateOutsideClick:!0,_checkParentVisibility:!1},this._getInnerOptionsCache("validationTooltipOptions"))),this._$validationMessage.toggleClass(f,"auto"===i).toggleClass(M,"always"===i);var o="dx-"+new d;this._validationMessage.$content().addClass(m).attr("id",o),this.setAria("describedby",o),this._setValidationMessageMaxWidth(),this._bindInnerWidgetOptions(this._validationMessage,"validationTooltipOptions")}},_setValidationMessageMaxWidth:function(){if(this._validationMessage)if(0!==this._getValidationMessageTarget().outerWidth()){var e=Math.max(100,this._getValidationMessageTarget().outerWidth());this._validationMessage.option("maxWidth",e)}else this._validationMessage.option("maxWidth","100%")},_getValidationMessageTarget:function(){return this.$element()},_getValidationMessagePosition:function(e){var t=this.option("rtlEnabled"),i=h(t),a=this.option("validationMessageOffset"),n={h:a.h,v:a.v},s="below"===e?[" top"," bottom"]:[" bottom"," top"];return t&&(n.h=-n.h),"below"!==e&&(n.v=-n.v),{offset:n,boundary:this.option("validationBoundary"),my:i+s[0],at:i+s[1],collision:"none flip"}},_toggleReadOnlyState:function(){this.$element().toggleClass("dx-state-readonly",!!this.option("readOnly")),this.setAria("readonly",this.option("readOnly")||void 0)},_dispose:function(){var e=this.$element()[0];n.data(e,C,null),clearTimeout(this.showValidationMessageTimeout),this.callBase()},_setSubmitElementName:function(e){var t=this._getSubmitElement();t&&(e.length>0?t.attr("name",e):t.removeAttr("name"))},_getSubmitElement:function(){return null},_getOptionsFromContainer:function(e){var t={},i;e.name===e.fullName?t=e.value:t[e.fullName.split(".").pop()]=e.value;return t},_setValidationTooltipOptions:function(e,t){this._setWidgetOption("_validationMessage",arguments)},_optionChanged:function(e){switch(e.name){case"onValueChanged":this._createValueChangeAction();break;case"isValid":case"validationError":case"validationBoundary":case"validationMessageMode":this._renderValidationState();break;case"validationTooltipOptions":this._setValidationTooltipOptions(this._getOptionsFromContainer(e)),this._cacheInnerOptions("validationTooltipOptions",e.value);break;case"readOnly":this._toggleReadOnlyState(),this._refreshFocusState();break;case"value":this._valueChangeActionSuppressed||(this._raiseValueChangeAction(e.value,e.previousValue),this._saveValueChangeEvent(void 0)),e.value!=e.previousValue&&this.validationRequest.fire({value:e.value,editor:this});break;case"width":this.callBase(e),this._setValidationMessageMaxWidth();break;case"name":this._setSubmitElementName(e.value);break;default:this.callBase(e)}},reset:function(){var e=this._getDefaultOptions();this.option("value",e.value)}}).include(c);i.exports=y}

