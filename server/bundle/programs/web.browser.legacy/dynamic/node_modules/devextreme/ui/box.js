function module(t,e,i){"use strict";var n=t("../core/renderer"),s=t("../events/core/events_engine"),o=t("../core/class"),a=t("../core/component_registrator"),r=t("../core/utils/extend").extend,c=t("../core/utils/common").noop,h=t("../core/utils/window"),l=t("../core/utils/inflector"),u=t("../core/utils/type").isDefined,d=t("../core/utils/style"),_=t("../core/utils/iterator").each,m=t("../core/utils/browser"),f=t("./collection/item"),g=t("../core/devices"),p=t("./collection/ui.collection_widget.edit"),x="dx-box",S=".dx-box",b="dx-box-item",y="dxBoxItemData",v={row:"minWidth",col:"minHeight"},I={row:"maxWidth",col:"maxHeight"},z=1,B={start:"flex-start",end:"flex-end",center:"center","space-between":"space-between","space-around":"space-around"},C={start:"flex-start",end:"flex-end",center:"center",stretch:"stretch"},w={row:"row",col:"column"},$=f.inherit({_renderVisible:function(t,e){this.callBase(t),u(e)&&this._options.fireItemStateChangedAction({name:"visible",state:t,oldState:e})}}),A=function(t,e,i){if(i=d.normalizeStyleProp(e,i),t.style[d.styleProp(e)]=i,!h.hasWindow()){if(""===i||!u(i))return;var n,s=l.dasherize(e)+": "+i+";";t.attributes.style?t.attributes.style.value.indexOf(s)<0&&(t.attributes.style.value+=" "+s):t.setAttribute("style",s)}},k=o.inherit({ctor:function(t,e){this._$element=t,this._option=e},renderBox:function(){this._$element.css({display:d.stylePropPrefix("flexDirection")+"flex"}),A(this._$element.get(0),"flexDirection",w[this._option("direction")])},renderAlign:function(){this._$element.css({justifyContent:this._normalizedAlign()})},_normalizedAlign:function(){var t=this._option("align");return t in B?B[t]:t},renderCrossAlign:function(){this._$element.css({alignItems:this._normalizedCrossAlign()})},_normalizedCrossAlign:function(){var t=this._option("crossAlign");return t in C?C[t]:t},renderItems:function(t){var e=d.stylePropPrefix("flexDirection"),i=this._option("direction");_(t,(function(){var t=n(this),s=t.data("dxBoxItemData");t.css({display:e+"flex"}).css(I[i],s.maxSize||"none").css(v[i],s.minSize||"0"),A(t.get(0),"flexBasis",s.baseSize||0),A(t.get(0),"flexGrow",s.ratio),A(t.get(0),"flexShrink",u(s.shrink)?s.shrink:1),t.children().each((function(t,e){n(e).css({width:"auto",height:"auto",display:d.stylePropPrefix("flexDirection")+"flex",flexBasis:0}),A(e,"flexGrow",1),A(e,"flexDirection",n(e)[0].style.flexDirection||"column")}))}))},initSize:c,update:c}),M="dxBox",D="dxupdate.dxBox",T="dx-box-fallback-item",q={row:"nowrap",col:"normal"},P={row:"width",col:"height"},R={row:"height",col:"width"},E={row:"marginLeft",col:"marginTop"},H={row:"marginRight",col:"marginBottom"},L={row:"marginTop",col:"marginLeft"},O={row:"marginBottom",col:"marginRight"},Q={marginLeft:"marginRight",marginRight:"marginLeft"},V=o.inherit({ctor:function(t,e){this._$element=t,this._option=e},renderBox:function(){this._$element.css({fontSize:0,whiteSpace:q[this._option("direction")],verticalAlign:"top"}),s.off(this._$element,D),s.on(this._$element,D,this.update.bind(this))},renderAlign:function(){var t=this._$items;if(t){var e=this._option("align"),i=0,n=this.totalItemSize,s=this._option("direction"),o,a=this._$element[P[s]]()-n;switch(this._setItemsMargins(t,s,0),e){case"start":break;case"end":i=a,t.first().css(this._chooseMarginSide(E[s]),i);break;case"center":i=.5*a,t.first().css(this._chooseMarginSide(E[s]),i),t.last().css(this._chooseMarginSide(H[s]),i);break;case"space-between":i=.5*a/(t.length-1),this._setItemsMargins(t,s,i),t.first().css(this._chooseMarginSide(E[s]),0),t.last().css(this._chooseMarginSide(H[s]),0);break;case"space-around":i=.5*a/t.length,this._setItemsMargins(t,s,i)}}},_setItemsMargins:function(t,e,i){t.css(this._chooseMarginSide(E[e]),i).css(this._chooseMarginSide(H[e]),i)},renderCrossAlign:function(){var t=this._$items;if(t){var e=this._option("crossAlign"),i=this._option("direction"),s=this._$element[R[i]](),o=this;switch(e){case"start":break;case"end":_(t,(function(){var t=n(this),e=t[R[i]](),a=s-e;t.css(o._chooseMarginSide(L[i]),a)}));break;case"center":_(t,(function(){var t=n(this),e=t[R[i]](),a=.5*(s-e);t.css(o._chooseMarginSide(L[i]),a).css(o._chooseMarginSide(O[i]),a)}));break;case"stretch":t.css(o._chooseMarginSide(L[i]),0).css(o._chooseMarginSide(O[i]),0).css(R[i],"100%")}}},_chooseMarginSide:function(t){return this._option("rtlEnabled")&&Q[t]||t},renderItems:function(t){this._$items=t;var e=this._option("direction"),i=0,s=0,o=0;_(t,function(t,a){var r=n(a);r.css({display:"inline-block",verticalAlign:"top"}),r[P[e]]("auto"),r.removeClass(T);var c=r.data("dxBoxItemData"),h=c.ratio||0,l=this._baseSize(r),d=u(c.shrink)?c.shrink:1;i+=h,s+=d*l,o+=l}.bind(this));var a=this._boxSize()-o,r=function(t){var e=t.data("dxBoxItemData"),n=this._baseSize(t),o=a>=0?e.ratio||0:(u(e.shrink)?e.shrink:1)*n,r=a>=0?i:s,c;return n+(r?Math.round(a*o/r):0)}.bind(this),c=0;_(t,(function(t,i){var s=n(i),o=n(i).data("dxBoxItemData"),a=r(s);c+=a,s.css(I[e],o.maxSize||"none").css(v[e],o.minSize||"0").css(P[e],a),s.addClass(T)})),this.totalItemSize=c},_baseSize:function(t){var e=n(t).data("dxBoxItemData");return null==e.baseSize?0:"auto"===e.baseSize?this._contentSize(t):this._parseSize(e.baseSize)},_contentSize:function(t){return n(t)[P[this._option("direction")]]()},_parseSize:function(t){return String(t).match(/.+%$/)?.01*parseFloat(t)*this._boxSizeValue:t},_boxSize:function(t){if(!arguments.length)return this._boxSizeValue=this._boxSizeValue||this._totalBaseSize(),this._boxSizeValue;this._boxSizeValue=t},_totalBaseSize:function(){var t=0;return _(this._$items,function(e,i){t+=this._baseSize(i)}.bind(this)),t},initSize:function(){this._boxSize(this._$element[P[this._option("direction")]]())},update:function(){if(this._$items&&!this._$element.is(":hidden")){this._$items.detach(),this.initSize(),this._$element.append(this._$items),this.renderItems(this._$items),this.renderAlign(),this.renderCrossAlign();var t=this._$element.get(0);this._$items.find(".dx-box").each((function(){t===n(this).parent().closest(".dx-box").get(0)&&s.triggerHandler(this,D)}))}}}),F=p.inherit({_getDefaultOptions:function(){return r(this.callBase(),{direction:"row",align:"start",crossAlign:"stretch",activeStateEnabled:!1,focusStateEnabled:!1,onItemStateChanged:void 0,_layoutStrategy:"flex",_queue:void 0})},_defaultOptionsRules:function(){return this.callBase().concat([{device:function t(){var t=g.real(),e="android"===t.platform&&(t.version[0]<4||4===t.version[0]&&t.version[1]<4),i="ios"===t.platform&&t.version[0]<7;return"win"===t.platform||m.msie||e||i},options:{_layoutStrategy:"fallback"}}])},_itemClass:function(){return"dx-box-item"},_itemDataKey:function(){return"dxBoxItemData"},_itemElements:function(){return this._itemContainer().children(this._itemSelector())},_init:function(){this.callBase(),this.$element().addClass("dx-box-"+this.option("_layoutStrategy")),this._initLayout(),this._initBoxQueue()},_initLayout:function(){this._layout="fallback"===this.option("_layoutStrategy")?new V(this.$element(),this.option.bind(this)):new k(this.$element(),this.option.bind(this))},_initBoxQueue:function(){this._queue=this.option("_queue")||[]},_queueIsNotEmpty:function(){return!this.option("_queue")&&!!this._queue.length},_pushItemToQueue:function(t,e){this._queue.push({$item:t,config:e})},_shiftItemFromQueue:function(){return this._queue.shift()},_initMarkup:function(){this.$element().addClass("dx-box"),this._layout.renderBox(),this.callBase(),this._renderAlign(),this._renderActions()},_renderActions:function(){this._onItemStateChanged=this._createActionByOption("onItemStateChanged")},_renderAlign:function(){this._layout.renderAlign(),this._layout.renderCrossAlign()},_renderItems:function(t){for(this._layout.initSize(),this.callBase(t);this._queueIsNotEmpty();){var e=this._shiftItemFromQueue();this._createComponent(e.$item,F,r({_layoutStrategy:this.option("_layoutStrategy"),itemTemplate:this.option("itemTemplate"),itemHoldTimeout:this.option("itemHoldTimeout"),onItemHold:this.option("onItemHold"),onItemClick:this.option("onItemClick"),onItemContextMenu:this.option("onItemContextMenu"),onItemRendered:this.option("onItemRendered"),_queue:this._queue},e.config))}this._layout.renderItems(this._itemElements()),clearTimeout(this._updateTimer),this._updateTimer=setTimeout(function(){this._isUpdated||this._layout.update(),this._isUpdated=!1,this._updateTimer=null}.bind(this))},_renderItemContent:function(t){var e=t.itemData&&t.itemData.node;return e?this._renderItemContentByNode(t,e):this.callBase(t)},_postprocessRenderItem:function(t){var e=t.itemData.box;e&&this._pushItemToQueue(t.itemContent,e)},_createItemByTemplate:function(t,e){return e.itemData.box?t.source?t.source():n():this.callBase(t,e)},_visibilityChanged:function(t){t&&this._dimensionChanged()},_dimensionChanged:function(){this._updateTimer||(this._isUpdated=!0,this._layout.update())},_dispose:function(){clearTimeout(this._updateTimer),this.callBase.apply(this,arguments)},_itemOptionChanged:function(t,e,i,n){"visible"===e&&this._onItemStateChanged({name:e,state:i,oldState:!1!==n}),this.callBase(t,e,i)},_optionChanged:function(t){switch(t.name){case"_layoutStrategy":case"_queue":case"direction":this._invalidate();break;case"align":this._layout.renderAlign();break;case"crossAlign":this._layout.renderCrossAlign();break;default:this.callBase(t)}},_itemOptions:function(){var t=this,e=this.callBase();return e.fireItemStateChangedAction=function(e){t._onItemStateChanged(e)},e},repaint:function(){this._dimensionChanged()}});F.ItemClass=$,a("dxBox",F),i.exports=F,i.exports.default=i.exports}

