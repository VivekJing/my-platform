function module(e,t,n){"use strict";var i,s=X(e("../../core/renderer")),a,o=X(e("../../events/core/events_engine")),r,l=X(e("../../core/utils/common")),d=e("../../core/utils/dom"),c,u=X(e("../../core/dom_adapter")),m=e("../../core/utils/type"),h=e("../../core/utils/deferred"),_=e("../../core/utils/extend"),f=e("../../core/utils/array"),p,I=X(e("../../core/utils/iterator")),g,v=X(e("../../core/action")),x,C=X(e("../../core/guid")),E,b=X(e("../widget/ui.widget")),F,D=X(e("../../events/utils")),A,y=X(e("../../events/pointer")),T,H=X(e("../../data_helper")),w,k=X(e("./item")),M,B=X(e("../widget/selectors")),P,S=X(e("../../localization/message")),N,O=X(e("../../events/hold")),R=e("../../core/utils/data"),$,L=X(e("../../events/click")),G,K=X(e("../../events/contextmenu")),W,V=X(e("../widget/bindable_template"));function X(e){return e&&e.__esModule?e:{default:e}}var j="dx-collection",z="dx-item",U="-content",q="dx-item-content-placeholder",J="dxItemData",Q="dxItemIndex",Y="tmpl-",Z="[data-options*='dxItem']",ee="dx-item-selected",te="dx-item-response-wait",ne="dx-empty-collection",ie="dx-template-wrapper",se=/^([^.]+\[\d+\]\.)+([\w.]+)$/,ae="up",oe="down",re="left",le="right",de="pageup",ce="pagedown",ue="last",me="first",he=b.default.inherit({_activeStateUnit:"."+z,_supportedKeys:function(){var e=function(e){var t=(0,s.default)(this.option("focusedElement"));t.length&&this._itemClickHandler((0,_.extend)({},e,{target:t,currentTarget:t}))},t=function(t){t.preventDefault(),e.call(this,t)},n=function(e,t){t.preventDefault(),t.stopPropagation(),this._moveFocus(e,t)};return(0,_.extend)(this.callBase(),{space:t,enter:e,leftArrow:n.bind(this,"left"),rightArrow:n.bind(this,"right"),upArrow:n.bind(this,"up"),downArrow:n.bind(this,"down"),pageUp:n.bind(this,"up"),pageDown:n.bind(this,"down"),home:n.bind(this,"first"),end:n.bind(this,"last")})},_getDefaultOptions:function(){return(0,_.extend)(this.callBase(),{selectOnFocus:!1,loopItemFocus:!0,items:[],itemTemplate:"item",onItemRendered:null,onItemClick:null,onItemHold:null,itemHoldTimeout:750,onItemContextMenu:null,onFocusedItemChanged:null,noDataText:S.default.format("dxCollectionWidget-noDataText"),dataSource:null,_itemAttributes:{},itemTemplateProperty:"template",focusOnSelectedItem:!0,focusedElement:null,displayExpr:void 0,disabledExpr:function(e){return e?e.disabled:void 0},visibleExpr:function(e){return e?e.visible:void 0}})},_getAnonymousTemplateName:function(){return"item"},_init:function(){this._compileDisplayGetter(),this.callBase(),this._cleanRenderedItems(),this._refreshDataSource()},_compileDisplayGetter:function(){var e=this.option("displayExpr");this._displayGetter=e?(0,R.compileGetter)(this.option("displayExpr")):void 0},_initTemplates:function(){this._initItemsFromMarkup(),this.callBase(),this._initDefaultItemTemplate()},_initDefaultItemTemplate:function(){var e=this._getFieldsMap();this._defaultTemplates.item=new V.default(function(t,n){(0,m.isPlainObject)(n)?this._prepareDefaultItemTemplate(n,t):(e&&(0,m.isFunction)(e.text)&&(n=e.text(n)),t.text(String(l.default.ensureDefined(n,""))))}.bind(this),this._getBindableFields(),this.option("integrationOptions.watchMethod"),e)},_getBindableFields:function(){return["text","html"]},_getFieldsMap:function(){if(this._displayGetter)return{text:this._displayGetter}},_prepareDefaultItemTemplate:function(e,t){(0,m.isDefined)(e.text)&&t.text(e.text),(0,m.isDefined)(e.html)&&t.html(e.html)},_initItemsFromMarkup:function(){var e=this,t=this.$element().contents().filter(Z);if(t.length&&!this.option("items").length){var n=[].slice.call(t).map((function(t){var n=(0,s.default)(t),i=(0,d.getElementOptions)(t).dxItem,a;return n.html().trim()&&!i.template?i.template=e._prepareItemTemplate(n):n.remove(),i}));this.option("items",n)}},_prepareItemTemplate:function(e){var t="tmpl-"+new C.default,n=e.detach().clone().removeAttr("data-options").addClass("dx-template-wrapper");return this._saveTemplate(t,n),t},_dataSourceOptions:function(){return{paginate:!1}},_cleanRenderedItems:function(){this._renderedItemsCount=0},_focusTarget:function(){return this.$element()},_focusInHandler:function(e){if(this.callBase.apply(this,arguments),-1!==(0,f.inArray)(e.target,this._focusTarget())){var t=(0,s.default)(this.option("focusedElement"));if(t.length)this._setFocusedItem(t);else{var n=this._getActiveItem();n.length&&this.option("focusedElement",(0,d.getPublicElement)(n))}}},_focusOutHandler:function(){this.callBase.apply(this,arguments);var e=(0,s.default)(this.option("focusedElement"));e.length&&this._toggleFocusClass(!1,e)},_getActiveItem:function(e){var t=(0,s.default)(this.option("focusedElement"));if(t.length)return t;var n=this.option("focusOnSelectedItem")?this.option("selectedIndex"):0,i=this._getActiveElement(),a=i.length-1;return n<0&&(n=e?a:0),i.eq(n)},_renderFocusTarget:function(){this.callBase.apply(this,arguments),this._refreshActiveDescendant()},_moveFocus:function(e){var t,n=this._getAvailableItems();switch(e){case"pageup":case"up":t=this._prevItem(n);break;case"pagedown":case"down":t=this._nextItem(n);break;case"right":t=this.option("rtlEnabled")?this._prevItem(n):this._nextItem(n);break;case"left":t=this.option("rtlEnabled")?this._nextItem(n):this._prevItem(n);break;case"first":t=n.first();break;case"last":t=n.last();break;default:return!1}0!==t.length&&this.option("focusedElement",(0,d.getPublicElement)(t))},_getVisibleItems:function(e){return(e=e||this._itemElements()).filter(":visible")},_getAvailableItems:function(e){return this._getVisibleItems(e).not(".dx-state-disabled")},_prevItem:function(e){var t=this._getActiveItem(),n=e.index(t),i=e.last(),a=(0,s.default)(e[n-1]),o=this.option("loopItemFocus");return 0===a.length&&o&&(a=i),a},_nextItem:function(e){var t=this._getActiveItem(!0),n=e.index(t),i=e.first(),a=(0,s.default)(e[n+1]),o=this.option("loopItemFocus");return 0===a.length&&o&&(a=i),a},_selectFocusedItem:function(e){this.selectItem(e)},_removeFocusedItem:function(e){var t=(0,s.default)(e);t.length&&(this._toggleFocusClass(!1,t),t.removeAttr("id"))},_refreshActiveDescendant:function(){this.setAria("activedescendant",""),this.setAria("activedescendant",this.getFocusedItemId())},_setFocusedItem:function(e){e&&e.length&&(e.attr("id",this.getFocusedItemId()),this._toggleFocusClass(!0,e),this.onFocusedItemChanged(this.getFocusedItemId()),this._refreshActiveDescendant(),this.option("selectOnFocus")&&this._selectFocusedItem(e))},_findItemElementByItem:function(e){var t=(0,s.default)(),n=this;return this.itemElements().each((function(){var i=(0,s.default)(this);if(i.data(n._itemDataKey())===e)return t=i,!1})),t},_getIndexByItem:function(e){return this.option("items").indexOf(e)},_itemOptionChanged:function(e,t,n,i){var s=this._findItemElementByItem(e);s.length&&(this.constructor.ItemClass.getInstance(s).setDataField(t,n)||this._refreshItem(s,e))},_refreshItem:function(e){var t=this._getItemData(e),n=e.data(this._itemIndexKey());this._renderItem(this._renderedItemsCount+n,t,null,e)},_optionChanged:function(e){if("items"===e.name){var t=e.fullName.match(se);if(t&&t.length){var n=t[t.length-1],i=e.fullName.replace("."+n,""),a=this.option(i);return void this._itemOptionChanged(a,n,e.value,e.previousValue)}}switch(e.name){case"items":case"_itemAttributes":case"itemTemplateProperty":this._cleanRenderedItems(),this._invalidate();break;case"dataSource":this._refreshDataSource(),this._renderEmptyMessage();break;case"noDataText":this._renderEmptyMessage();break;case"itemTemplate":this._invalidate();break;case"onItemRendered":this._createItemRenderAction();break;case"onItemClick":break;case"onItemHold":case"itemHoldTimeout":this._attachHoldEvent();break;case"onItemContextMenu":this._attachContextMenuEvent();break;case"onFocusedItemChanged":this.onFocusedItemChanged=this._createActionByOption("onFocusedItemChanged");break;case"selectOnFocus":case"loopItemFocus":case"focusOnSelectedItem":break;case"focusedElement":this._removeFocusedItem(e.previousValue),this._setFocusedItem((0,s.default)(e.value));break;case"displayExpr":this._compileDisplayGetter(),this._initDefaultItemTemplate(),this._invalidate();break;case"visibleExpr":case"disabledExpr":this._invalidate();break;default:this.callBase(e)}},_loadNextPage:function(){var e=this._dataSource;return this._expectNextPageLoading(),e.pageIndex(1+e.pageIndex()),e.load()},_expectNextPageLoading:function(){this._startIndexForAppendedItems=0},_expectLastItemLoading:function(){this._startIndexForAppendedItems=-1},_forgetNextPageLoading:function(){this._startIndexForAppendedItems=null},_dataSourceChangedHandler:function(e){var t=this.option("items");this._initialized&&t&&this._shouldAppendItems()?(this._renderedItemsCount=t.length,this._isLastPage()&&-1===this._startIndexForAppendedItems||(this.option().items=t.concat(e.slice(this._startIndexForAppendedItems))),this._forgetNextPageLoading(),this._refreshContent(),this._renderFocusTarget()):this.option("items",e.slice())},_refreshContent:function(){this._prepareContent(),this._renderContent()},_dataSourceLoadErrorHandler:function(){this._forgetNextPageLoading(),this.option("items",this.option("items"))},_shouldAppendItems:function(){return null!=this._startIndexForAppendedItems&&this._allowDynamicItemsAppend()},_allowDynamicItemsAppend:function(){return!1},_clean:function(){this._cleanFocusState(),this._cleanItemContainer()},_cleanItemContainer:function(){(0,s.default)(this._itemContainer()).empty()},_dispose:function(){this.callBase(),clearTimeout(this._itemFocusTimeout)},_refresh:function(){this._cleanRenderedItems(),this.callBase.apply(this,arguments)},_itemContainer:function(){return this.$element()},_itemClass:function(){return z},_itemContentClass:function(){return this._itemClass()+"-content"},_selectedItemClass:function(){return"dx-item-selected"},_itemResponseWaitClass:function(){return"dx-item-response-wait"},_itemSelector:function(){return"."+this._itemClass()},_itemDataKey:function(){return"dxItemData"},_itemIndexKey:function(){return"dxItemIndex"},_itemElements:function(){return this._itemContainer().find(this._itemSelector())},_initMarkup:function(){this.callBase(),this.onFocusedItemChanged=this._createActionByOption("onFocusedItemChanged"),this.$element().addClass("dx-collection"),this._prepareContent()},_prepareContent:l.default.deferRenderer((function(){this._renderContentImpl()})),_renderContent:function(){this._fireContentReadyAction()},_render:function(){this.callBase(),this._attachClickEvent(),this._attachHoldEvent(),this._attachContextMenuEvent()},_attachClickEvent:function(){var e=this._itemSelector(),t=D.default.addNamespace(L.default.name,this.NAME),n=D.default.addNamespace(y.default.down,this.NAME),i=this,a=new v.default((function(e){var t=e.event;i._itemPointerDownHandler(t)}));o.default.off(this._itemContainer(),t,e),o.default.off(this._itemContainer(),n,e),o.default.on(this._itemContainer(),t,e,function(e){this._itemClickHandler(e)}.bind(this)),o.default.on(this._itemContainer(),n,e,(function(e){a.execute({element:(0,s.default)(e.target),event:e})}))},_itemClickHandler:function(e,t,n){this._itemDXEventHandler(e,"onItemClick",t,n)},_itemPointerDownHandler:function(e){this.option("focusStateEnabled")&&(this._itemFocusHandler=function(){if(clearTimeout(this._itemFocusTimeout),this._itemFocusHandler=null,!e.isDefaultPrevented()){var t=(0,s.default)(e.target),n=t.closest(this._itemElements()),i=this._closestFocusable(t);n.length&&i&&-1!==(0,f.inArray)(i.get(0),this._focusTarget())&&this.option("focusedElement",(0,d.getPublicElement)(n))}}.bind(this),this._itemFocusTimeout=setTimeout(this._forcePointerDownFocus.bind(this)))},_closestFocusable:function(e){if(e.is(B.default.focusable))return e;for(e=e.parent();e.length&&!u.default.isDocument(e.get(0));){if(e.is(B.default.focusable))return e;e=e.parent()}},_forcePointerDownFocus:function(){this._itemFocusHandler&&this._itemFocusHandler()},_updateFocusState:function(){this.callBase.apply(this,arguments),this._forcePointerDownFocus()},_attachHoldEvent:function(){var e=this._itemContainer(),t=this._itemSelector(),n=D.default.addNamespace(O.default.name,this.NAME);o.default.off(e,n,t),o.default.on(e,n,t,{timeout:this._getHoldTimeout()},this._itemHoldHandler.bind(this))},_getHoldTimeout:function(){return this.option("itemHoldTimeout")},_shouldFireHoldEvent:function(){return this.hasActionSubscription("onItemHold")},_itemHoldHandler:function(e){this._shouldFireHoldEvent()?this._itemDXEventHandler(e,"onItemHold"):e.cancel=!0},_attachContextMenuEvent:function(){var e=this._itemContainer(),t=this._itemSelector(),n=D.default.addNamespace(K.default.name,this.NAME);o.default.off(e,n,t),o.default.on(e,n,t,this._itemContextMenuHandler.bind(this))},_shouldFireContextMenuEvent:function(){return this.hasActionSubscription("onItemContextMenu")},_itemContextMenuHandler:function(e){this._shouldFireContextMenuEvent()?this._itemDXEventHandler(e,"onItemContextMenu"):e.cancel=!0},_renderContentImpl:function(){var e=this.option("items")||[];this._renderedItemsCount?this._renderItems(e.slice(this._renderedItemsCount)):this._renderItems(e)},_renderItems:function(e){e.length&&I.default.each(e,function(e,t){this._renderItem(this._renderedItemsCount+e,t)}.bind(this)),this._renderEmptyMessage()},_renderItem:function(e,t,n,i){n=n||this._itemContainer();var s=this._renderItemFrame(e,t,n,i);this._setElementData(s,t,e),s.attr(this.option("_itemAttributes")),this._attachItemClickEvent(t,s);var a=this._getItemContent(s),o=this._renderItemContent({index:e,itemData:t,container:(0,d.getPublicElement)(a),contentClass:this._itemContentClass(),defaultTemplateName:this.option("itemTemplate")}),r=this;return(0,h.when)(o).done((function(n){r._postprocessRenderItem({itemElement:s,itemContent:n,itemData:t,itemIndex:e}),r._executeItemRenderAction(e,t,(0,d.getPublicElement)(s))})),s},_getItemContent:function(e){var t=e.find(".dx-item-content-placeholder");return t.removeClass("dx-item-content-placeholder"),t},_attachItemClickEvent:function(e,t){e&&e.onClick&&o.default.on(t,L.default.name,function(n){this._itemEventHandlerByHandler(t,e.onClick,{event:n})}.bind(this))},_renderItemContent:function(e){var t=this._getItemTemplateName(e),n=this._getTemplate(t);this._addItemContentClasses(e);var i=(0,s.default)(this._createItemByTemplate(n,e));return i.hasClass("dx-template-wrapper")?this._renderItemContentByNode(e,i):e.container},_renderItemContentByNode:function(e,t){return(0,s.default)(e.container).replaceWith(t),e.container=(0,d.getPublicElement)(t),this._addItemContentClasses(e),t},_addItemContentClasses:function(e){var t=[z+"-content",e.contentClass];(0,s.default)(e.container).addClass(t.join(" "))},_appendItemToContainer:function(e,t,n){t.appendTo(e)},_renderItemFrame:function(e,t,n,i){var a=(0,s.default)("<div>");return new this.constructor.ItemClass(a,this._itemOptions(),t||{}),i&&i.length?i.replaceWith(a):this._appendItemToContainer.call(this,n,a,e),a},_itemOptions:function(){var e=this;return{watchMethod:function(){return e.option("integrationOptions.watchMethod")},fieldGetter:function(t){var n=e.option(t+"Expr"),i;return(0,R.compileGetter)(n)}}},_postprocessRenderItem:l.default.noop,_executeItemRenderAction:function(e,t,n){this._getItemRenderAction()({itemElement:n,itemIndex:e,itemData:t})},_setElementData:function(e,t,n){e.addClass([z,this._itemClass()].join(" ")).data(this._itemDataKey(),t).data(this._itemIndexKey(),n)},_createItemRenderAction:function(){return this._itemRenderAction=this._createActionByOption("onItemRendered",{element:this.element(),excludeValidators:["designMode","disabled","readOnly"],category:"rendering"})},_getItemRenderAction:function(){return this._itemRenderAction||this._createItemRenderAction()},_getItemTemplateName:function(e){var t=e.itemData,n=e.templateProperty||this.option("itemTemplateProperty"),i;return t&&t[n]||e.defaultTemplateName},_createItemByTemplate:function(e,t){return e.render({model:t.itemData,container:t.container,index:t.index})},_emptyMessageContainer:function(){return this._itemContainer()},_renderEmptyMessage:function(e){e=e||this.option("items");var t=this.option("noDataText"),n=!t||e&&e.length||this._isDataSourceLoading();n&&this._$noData&&(this._$noData.remove(),this._$noData=null,this.setAria("label",void 0)),n||(this._$noData=this._$noData||(0,s.default)("<div>").addClass("dx-empty-message"),this._$noData.appendTo(this._emptyMessageContainer()).html(t),this.setAria("label",t)),this.$element().toggleClass(ne,!n)},_itemDXEventHandler:function(e,t,n,i){this._itemEventHandler(e.target,t,(0,_.extend)(n,{event:e}),i)},_itemEventHandler:function(e,t,n,i){var s=this._createActionByOption(t,(0,_.extend)({validatingTargetName:"itemElement"},i));return this._itemEventHandlerImpl(e,s,n)},_itemEventHandlerByHandler:function(e,t,n,i){var s=this._createAction(t,(0,_.extend)({validatingTargetName:"itemElement"},i));return this._itemEventHandlerImpl(e,s,n)},_itemEventHandlerImpl:function(e,t,n){var i=this._closestItemElement((0,s.default)(e)),a=(0,_.extend)({},n);return t((0,_.extend)(n,this._extendActionArgs(i),a))},_extendActionArgs:function(e){return{itemElement:(0,d.getPublicElement)(e),itemIndex:this._itemElements().index(e),itemData:this._getItemData(e)}},_closestItemElement:function(e){return(0,s.default)(e).closest(this._itemSelector())},_getItemData:function(e){return(0,s.default)(e).data(this._itemDataKey())},_getSummaryItemsWidth:function(e,t){var n=0;return e&&I.default.each(e,(function(e,i){n+=(0,s.default)(i).outerWidth(t||!1)})),n},getFocusedItemId:function(){return this._focusedItemId||(this._focusedItemId="dx-"+new C.default),this._focusedItemId},itemElements:function(){return this._itemElements()},itemsContainer:function(){return this._itemContainer()}}).include(H.default);he.ItemClass=k.default,n.exports=he}

