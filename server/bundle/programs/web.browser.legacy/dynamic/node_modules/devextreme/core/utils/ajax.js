function module(e,t,r){"use strict";var n=e("./deferred").Deferred,o=e("../../core/dom_adapter"),a=e("../../core/http_request"),s=e("../../core/utils/window"),c=s.getWindow(),i=e("./extend").extendFromObject,p=e("./type").isDefined,u=e("../polyfills/promise"),l=e("./dependency_injector"),d="success",f="error",m="timeout",h="nocontent",v="parsererror",y=function(e){return 200<=e&&e<300},x=function(e){return 204!==e},j=function(e){var t=[];for(var r in e){var n=e[r];void 0!==n&&(null===n&&(n=""),t.push(encodeURIComponent(r)+"="+encodeURIComponent(n)))}return t.join("&")},T=function(e){var t=o.createElement("script");for(var r in e)t[r]=e[r];return t},w=function(e){e.parentNode.removeChild(e)},b=function(e){return o.getHead().appendChild(e)},C=function(e){var t=T({text:e});b(t),w(t)},g=function(e){var t=T({src:e});return new u((function(e,r){var n={load:e,error:r},a=function(e){n[e.type](),w(t)};for(var s in n)o.listen(t,s,a);b(t)}))},D=function(e){var t=e.dataType||"*",r="text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",n={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript",jsonp:r,script:r};return i(n,e.accepts,!0),n[t]?n[t]+("*"!==t?", */*; q=0.01":""):n["*"]},q=function(e){var t;return e.data&&!e.upload&&"GET"!==F(e)&&(t="application/x-www-form-urlencoded;charset=utf-8"),e.contentType||t},R=function(e){return e.responseType&&"text"!==e.responseType||"string"!=typeof e.responseText?e.response:e.responseText},S=function(e,t,r){var n=R(t);switch(r){case"jsonp":C(n);break;case"script":C(n),e.resolve(n,d,t);break;case"json":try{e.resolve(JSON.parse(n),d,t)}catch(o){e.reject(t,v,o)}break;default:e.resolve(n,d,t)}},k=function(e){if(!s.hasWindow())return!0;var t=!1,r=o.createElement("a"),n=o.createElement("a");r.href=c.location.href;try{n.href=e,n.href=n.href,t=r.protocol+"//"+r.host!=n.protocol+"//"+n.host}catch(a){t=!0}return t},E=function(e,t){return e&&setTimeout((function(){t.customStatus=m,t.abort()}),e)},O=function(e){if("jsonp"===e.dataType){var t=Math.random().toString().replace(/\D/g,""),r=e.jsonpCallback||"dxCallback"+Date.now()+"_"+t,n=e.jsonp||"callback";return e.data=e.data||{},e.data[n]=r,r}},_=function(e,t){var r=e.data,n="string"==typeof r,o=e.url||c.location.href;return n||e.cache||((r=r||{})._=Date.now()),r&&!e.upload&&(n||(r=j(r)),"GET"===F(e)?(""!==r&&(o+=(o.indexOf("?")>-1?"&":"?")+r),r=null):t["Content-Type"]&&t["Content-Type"].indexOf("application/x-www-form-urlencoded")>-1&&(r=r.replace(/%20/g,"+"))),{url:o,parameters:r}},F=function(e){return(e.method||"GET").toUpperCase()},W=function(e){var t=e.headers||{};return t["Content-Type"]=t["Content-Type"]||q(e),t.Accept=t.Accept||D(e),e.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t},X=function(e){var t,r=a.getXhr(),o=new n,s=o.promise(),i=!p(e.async)||e.async,u=e.dataType,l=e.timeout||0;e.crossDomain=k(e.url);var m="jsonp"===u||"script"===u;void 0===e.cache&&(e.cache=!m);var v=O(e),j=W(e),T=_(e,j),w=T.url,b=T.parameters;if(v&&(c[v]=function(e){o.resolve(e,d,r)}),e.crossDomain&&m){var C=function(){o.reject(r,f)},D=function(){"jsonp"!==u&&o.resolve(null,d,r)};return g(w).then(D,C),s}if(e.crossDomain&&!("withCredentials"in r))return o.reject(r,f),s;if(r.open(F(e),w,i,e.username,e.password),i&&(r.timeout=l,t=E(l,r,o)),r.onreadystatechange=function(e){4===r.readyState&&(clearTimeout(t),y(r.status)?x(r.status)?S(o,r,u):o.resolve(null,h,r):o.reject(r,r.customStatus||f))},e.upload&&(r.upload.onprogress=e.upload.onprogress,r.upload.onloadstart=e.upload.onloadstart,r.upload.onabort=e.upload.onabort),e.xhrFields)for(var q in e.xhrFields)r[q]=e.xhrFields[q];for(var R in"arraybuffer"===e.responseType&&(r.responseType=e.responseType),j)j.hasOwnProperty(R)&&p(j[R])&&r.setRequestHeader(R,j[R]);return e.beforeSend&&e.beforeSend(r),r.send(b),s.abort=function(){r.abort()},s};r.exports=l({sendRequest:X})}

